{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nvar __values = this && this.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n    m = s && o[s],\n    i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n    r,\n    ar = [],\n    e;\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n  return ar;\n};\nimport { Amplify, ConsoleLogger as Logger, Hub, JS } from '@aws-amplify/core';\nimport { immerable, produce, setAutoFreeze, enablePatches } from 'immer';\nimport { v4 as uuid4 } from 'uuid';\nimport Observable from 'zen-observable-ts';\nimport { defaultAuthStrategy, multiAuthStrategy } from '../authModeStrategies';\nimport { isPredicatesAll, ModelPredicateCreator, ModelSortPredicateCreator } from '../predicates';\nimport { ExclusiveStorage as Storage } from '../storage/storage';\nimport { ControlMessage, SyncEngine } from '../sync';\nimport { GraphQLScalarType, isGraphQLScalarType, AuthModeStrategyType } from '../types';\nimport { DATASTORE, establishRelation, exhaustiveCheck, isModelConstructor, monotonicUlidFactory, STORAGE, SYNC, USER, isNullOrUndefined } from '../util';\nsetAutoFreeze(true);\nenablePatches();\nvar logger = new Logger('DataStore');\nvar ulid = monotonicUlidFactory(Date.now());\nvar isNode = JS.browserOrNode().isNode;\nvar SETTING_SCHEMA_VERSION = 'schemaVersion';\nvar schema;\nvar modelNamespaceMap = new WeakMap();\n// stores data for crafting the correct update mutation input for a model\n// Patch[] - array of changed fields and metadata\n// PersistentModel - the source model, used for diffing object-type fields\nvar modelPatchesMap = new WeakMap();\nvar getModelDefinition = function (modelConstructor) {\n  var namespace = modelNamespaceMap.get(modelConstructor);\n  return schema.namespaces[namespace].models[modelConstructor.name];\n};\nvar isValidModelConstructor = function (obj) {\n  return isModelConstructor(obj) && modelNamespaceMap.has(obj);\n};\nvar namespaceResolver = function (modelConstructor) {\n  return modelNamespaceMap.get(modelConstructor);\n};\n// exporting syncClasses for testing outbox.test.ts\nexport var syncClasses;\nvar userClasses;\nvar dataStoreClasses;\nvar storageClasses;\nvar initSchema = function (userSchema) {\n  var _a;\n  if (schema !== undefined) {\n    console.warn('The schema has already been initialized');\n    return userClasses;\n  }\n  logger.log('validating schema', {\n    schema: userSchema\n  });\n  var internalUserNamespace = __assign({\n    name: USER\n  }, userSchema);\n  logger.log('DataStore', 'Init models');\n  userClasses = createTypeClasses(internalUserNamespace);\n  logger.log('DataStore', 'Models initialized');\n  var dataStoreNamespace = getNamespace();\n  var storageNamespace = Storage.getNamespace();\n  var syncNamespace = SyncEngine.getNamespace();\n  dataStoreClasses = createTypeClasses(dataStoreNamespace);\n  storageClasses = createTypeClasses(storageNamespace);\n  syncClasses = createTypeClasses(syncNamespace);\n  schema = {\n    namespaces: (_a = {}, _a[dataStoreNamespace.name] = dataStoreNamespace, _a[internalUserNamespace.name] = internalUserNamespace, _a[storageNamespace.name] = storageNamespace, _a[syncNamespace.name] = syncNamespace, _a),\n    version: userSchema.version\n  };\n  Object.keys(schema.namespaces).forEach(function (namespace) {\n    var e_1, _a;\n    schema.namespaces[namespace].relationships = establishRelation(schema.namespaces[namespace]);\n    var modelAssociations = new Map();\n    Object.values(schema.namespaces[namespace].models).forEach(function (model) {\n      var connectedModels = [];\n      Object.values(model.fields).filter(function (field) {\n        return field.association && field.association.connectionType === 'BELONGS_TO' && field.type.model !== model.name;\n      }).forEach(function (field) {\n        return connectedModels.push(field.type.model);\n      });\n      modelAssociations.set(model.name, connectedModels);\n    });\n    var result = new Map();\n    var count = 1000;\n    while (true && count > 0) {\n      if (modelAssociations.size === 0) {\n        break;\n      }\n      count--;\n      if (count === 0) {\n        throw new Error('Models are not topologically sortable. Please verify your schema.');\n      }\n      try {\n        for (var _b = (e_1 = void 0, __values(Array.from(modelAssociations.keys()))), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var modelName = _c.value;\n          var parents = modelAssociations.get(modelName);\n          if (parents.every(function (x) {\n            return result.has(x);\n          })) {\n            result.set(modelName, parents);\n          }\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n      Array.from(result.keys()).forEach(function (x) {\n        return modelAssociations.delete(x);\n      });\n    }\n    schema.namespaces[namespace].modelTopologicalOrdering = result;\n  });\n  return userClasses;\n};\nvar createTypeClasses = function (namespace) {\n  var classes = {};\n  Object.entries(namespace.models).forEach(function (_a) {\n    var _b = __read(_a, 2),\n      modelName = _b[0],\n      modelDefinition = _b[1];\n    var clazz = createModelClass(modelDefinition);\n    classes[modelName] = clazz;\n    modelNamespaceMap.set(clazz, namespace.name);\n  });\n  Object.entries(namespace.nonModels || {}).forEach(function (_a) {\n    var _b = __read(_a, 2),\n      typeName = _b[0],\n      typeDefinition = _b[1];\n    var clazz = createNonModelClass(typeDefinition);\n    classes[typeName] = clazz;\n  });\n  return classes;\n};\nvar instancesMetadata = new WeakSet();\nfunction modelInstanceCreator(modelConstructor, init) {\n  instancesMetadata.add(init);\n  return new modelConstructor(init);\n}\nvar validateModelFields = function (modelDefinition) {\n  return function (k, v) {\n    var fieldDefinition = modelDefinition.fields[k];\n    if (fieldDefinition !== undefined) {\n      var type = fieldDefinition.type,\n        isRequired_1 = fieldDefinition.isRequired,\n        isArrayNullable = fieldDefinition.isArrayNullable,\n        name_1 = fieldDefinition.name,\n        isArray = fieldDefinition.isArray;\n      if ((!isArray && isRequired_1 || isArray && !isArrayNullable) && (v === null || v === undefined)) {\n        throw new Error(\"Field \" + name_1 + \" is required\");\n      }\n      if (isGraphQLScalarType(type)) {\n        var jsType_1 = GraphQLScalarType.getJSType(type);\n        var validateScalar_1 = GraphQLScalarType.getValidationFunction(type);\n        if (isArray) {\n          var errorTypeText = jsType_1;\n          if (!isRequired_1) {\n            errorTypeText = jsType_1 + \" | null | undefined\";\n          }\n          if (!Array.isArray(v) && !isArrayNullable) {\n            throw new Error(\"Field \" + name_1 + \" should be of type [\" + errorTypeText + \"], \" + typeof v + \" received. \" + v);\n          }\n          if (!isNullOrUndefined(v) && v.some(function (e) {\n            return isNullOrUndefined(e) ? isRequired_1 : typeof e !== jsType_1;\n          })) {\n            var elemTypes = v.map(function (e) {\n              return e === null ? 'null' : typeof e;\n            }).join(',');\n            throw new Error(\"All elements in the \" + name_1 + \" array should be of type \" + errorTypeText + \", [\" + elemTypes + \"] received. \" + v);\n          }\n          if (validateScalar_1 && !isNullOrUndefined(v)) {\n            var validationStatus = v.map(function (e) {\n              if (!isNullOrUndefined(e)) {\n                return validateScalar_1(e);\n              } else if (isNullOrUndefined(e) && !isRequired_1) {\n                return true;\n              } else {\n                return false;\n              }\n            });\n            if (!validationStatus.every(function (s) {\n              return s;\n            })) {\n              throw new Error(\"All elements in the \" + name_1 + \" array should be of type \" + type + \", validation failed for one or more elements. \" + v);\n            }\n          }\n        } else if (!isRequired_1 && v === undefined) {\n          return;\n        } else if (typeof v !== jsType_1 && v !== null) {\n          throw new Error(\"Field \" + name_1 + \" should be of type \" + jsType_1 + \", \" + typeof v + \" received. \" + v);\n        } else if (!isNullOrUndefined(v) && validateScalar_1 && !validateScalar_1(v)) {\n          throw new Error(\"Field \" + name_1 + \" should be of type \" + type + \", validation failed. \" + v);\n        }\n      }\n    }\n  };\n};\nvar initializeInstance = function (init, modelDefinition, draft) {\n  var modelValidator = validateModelFields(modelDefinition);\n  Object.entries(init).forEach(function (_a) {\n    var _b = __read(_a, 2),\n      k = _b[0],\n      v = _b[1];\n    modelValidator(k, v);\n    draft[k] = v;\n  });\n};\nvar createModelClass = function (modelDefinition) {\n  var clazz = /** @class */function () {\n    function Model(init) {\n      var instance = produce(this, function (draft) {\n        initializeInstance(init, modelDefinition, draft);\n        var modelInstanceMetadata = instancesMetadata.has(init) ? init : {};\n        var _id = modelInstanceMetadata.id,\n          _version = modelInstanceMetadata._version,\n          _lastChangedAt = modelInstanceMetadata._lastChangedAt,\n          _deleted = modelInstanceMetadata._deleted;\n        var id =\n        // instancesIds is set by modelInstanceCreator, it is accessible only internally\n        _id !== null && _id !== undefined ? _id : modelDefinition.syncable ? uuid4() : ulid();\n        draft.id = id;\n        if (modelDefinition.syncable) {\n          draft._version = _version;\n          draft._lastChangedAt = _lastChangedAt;\n          draft._deleted = _deleted;\n        }\n      });\n      return instance;\n    }\n    Model.copyOf = function (source, fn) {\n      var modelConstructor = Object.getPrototypeOf(source || {}).constructor;\n      if (!isValidModelConstructor(modelConstructor)) {\n        var msg = 'The source object is not a valid model';\n        logger.error(msg, {\n          source: source\n        });\n        throw new Error(msg);\n      }\n      var patches;\n      var model = produce(source, function (draft) {\n        fn(draft);\n        draft.id = source.id;\n        var modelValidator = validateModelFields(modelDefinition);\n        Object.entries(draft).forEach(function (_a) {\n          var _b = __read(_a, 2),\n            k = _b[0],\n            v = _b[1];\n          modelValidator(k, v);\n        });\n      }, function (p) {\n        return patches = p;\n      });\n      if (patches.length) {\n        modelPatchesMap.set(model, [patches, source]);\n      }\n      return model;\n    };\n    // \"private\" method (that's hidden via `Setting`) for `withSSRContext` to use\n    // to gain access to `modelInstanceCreator` and `clazz` for persisting IDs from server to client.\n    Model.fromJSON = function (json) {\n      var _this = this;\n      if (Array.isArray(json)) {\n        return json.map(function (init) {\n          return _this.fromJSON(init);\n        });\n      }\n      var instance = modelInstanceCreator(clazz, json);\n      var modelValidator = validateModelFields(modelDefinition);\n      Object.entries(instance).forEach(function (_a) {\n        var _b = __read(_a, 2),\n          k = _b[0],\n          v = _b[1];\n        modelValidator(k, v);\n      });\n      return instance;\n    };\n    return Model;\n  }();\n  clazz[immerable] = true;\n  Object.defineProperty(clazz, 'name', {\n    value: modelDefinition.name\n  });\n  return clazz;\n};\nvar createNonModelClass = function (typeDefinition) {\n  var clazz = /** @class */function () {\n    function Model(init) {\n      var instance = produce(this, function (draft) {\n        initializeInstance(init, typeDefinition, draft);\n      });\n      return instance;\n    }\n    return Model;\n  }();\n  clazz[immerable] = true;\n  Object.defineProperty(clazz, 'name', {\n    value: typeDefinition.name\n  });\n  return clazz;\n};\nfunction isQueryOne(obj) {\n  return typeof obj === 'string';\n}\nfunction defaultConflictHandler(conflictData) {\n  var localModel = conflictData.localModel,\n    modelConstructor = conflictData.modelConstructor,\n    remoteModel = conflictData.remoteModel;\n  var _version = remoteModel._version;\n  return modelInstanceCreator(modelConstructor, __assign(__assign({}, localModel), {\n    _version: _version\n  }));\n}\nfunction defaultErrorHandler(error) {\n  logger.warn(error);\n}\nfunction getModelConstructorByModelName(namespaceName, modelName) {\n  var result;\n  switch (namespaceName) {\n    case DATASTORE:\n      result = dataStoreClasses[modelName];\n      break;\n    case USER:\n      result = userClasses[modelName];\n      break;\n    case SYNC:\n      result = syncClasses[modelName];\n      break;\n    case STORAGE:\n      result = storageClasses[modelName];\n      break;\n    default:\n      exhaustiveCheck(namespaceName);\n      break;\n  }\n  if (isValidModelConstructor(result)) {\n    return result;\n  } else {\n    var msg = \"Model name is not valid for namespace. modelName: \" + modelName + \", namespace: \" + namespaceName;\n    logger.error(msg);\n    throw new Error(msg);\n  }\n}\nfunction checkSchemaVersion(storage, version) {\n  return __awaiter(this, void 0, void 0, function () {\n    var Setting, modelDefinition;\n    var _this = this;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          Setting = dataStoreClasses.Setting;\n          modelDefinition = schema.namespaces[DATASTORE].models.Setting;\n          return [4 /*yield*/, storage.runExclusive(function (s) {\n            return __awaiter(_this, void 0, void 0, function () {\n              var _a, schemaVersionSetting, storedValue;\n              return __generator(this, function (_b) {\n                switch (_b.label) {\n                  case 0:\n                    return [4 /*yield*/, s.query(Setting, ModelPredicateCreator.createFromExisting(modelDefinition, function (c) {\n                      // @ts-ignore Argument of type '\"eq\"' is not assignable to parameter of type 'never'.\n                      return c.key('eq', SETTING_SCHEMA_VERSION);\n                    }), {\n                      page: 0,\n                      limit: 1\n                    })];\n                  case 1:\n                    _a = __read.apply(void 0, [_b.sent(), 1]), schemaVersionSetting = _a[0];\n                    if (!(schemaVersionSetting !== undefined && schemaVersionSetting.value !== undefined)) return [3 /*break*/, 4];\n                    storedValue = JSON.parse(schemaVersionSetting.value);\n                    if (!(storedValue !== version)) return [3 /*break*/, 3];\n                    return [4 /*yield*/, s.clear(false)];\n                  case 2:\n                    _b.sent();\n                    _b.label = 3;\n                  case 3:\n                    return [3 /*break*/, 6];\n                  case 4:\n                    return [4 /*yield*/, s.save(modelInstanceCreator(Setting, {\n                      key: SETTING_SCHEMA_VERSION,\n                      value: JSON.stringify(version)\n                    }))];\n                  case 5:\n                    _b.sent();\n                    _b.label = 6;\n                  case 6:\n                    return [2 /*return*/];\n                }\n              });\n            });\n          })];\n        case 1:\n          _a.sent();\n          return [2 /*return*/];\n      }\n    });\n  });\n}\nvar syncSubscription;\nfunction getNamespace() {\n  var namespace = {\n    name: DATASTORE,\n    relationships: {},\n    enums: {},\n    nonModels: {},\n    models: {\n      Setting: {\n        name: 'Setting',\n        pluralName: 'Settings',\n        syncable: false,\n        fields: {\n          id: {\n            name: 'id',\n            type: 'ID',\n            isRequired: true,\n            isArray: false\n          },\n          key: {\n            name: 'key',\n            type: 'String',\n            isRequired: true,\n            isArray: false\n          },\n          value: {\n            name: 'value',\n            type: 'String',\n            isRequired: true,\n            isArray: false\n          }\n        }\n      }\n    }\n  };\n  return namespace;\n}\nvar DataStore = /** @class */function () {\n  function DataStore() {\n    var _this = this;\n    this.amplifyConfig = {};\n    this.syncPredicates = new WeakMap();\n    this.start = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var aws_appsync_graphqlEndpoint, _a, fullSyncIntervalInMilliseconds;\n        var _this = this;\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              if (!(this.initialized === undefined)) return [3 /*break*/, 1];\n              logger.debug('Starting DataStore');\n              this.initialized = new Promise(function (res, rej) {\n                _this.initResolve = res;\n                _this.initReject = rej;\n              });\n              return [3 /*break*/, 3];\n            case 1:\n              return [4 /*yield*/, this.initialized];\n            case 2:\n              _b.sent();\n              return [2 /*return*/];\n            case 3:\n              this.storage = new Storage(schema, namespaceResolver, getModelConstructorByModelName, modelInstanceCreator, undefined, this.sessionId);\n              return [4 /*yield*/, this.storage.init()];\n            case 4:\n              _b.sent();\n              return [4 /*yield*/, checkSchemaVersion(this.storage, schema.version)];\n            case 5:\n              _b.sent();\n              aws_appsync_graphqlEndpoint = this.amplifyConfig.aws_appsync_graphqlEndpoint;\n              if (!aws_appsync_graphqlEndpoint) return [3 /*break*/, 7];\n              logger.debug('GraphQL endpoint available', aws_appsync_graphqlEndpoint);\n              _a = this;\n              return [4 /*yield*/, this.processSyncExpressions()];\n            case 6:\n              _a.syncPredicates = _b.sent();\n              this.sync = new SyncEngine(schema, namespaceResolver, syncClasses, userClasses, this.storage, modelInstanceCreator, this.maxRecordsToSync, this.syncPageSize, this.conflictHandler, this.errorHandler, this.syncPredicates, this.amplifyConfig, this.authModeStrategy);\n              fullSyncIntervalInMilliseconds = this.fullSyncInterval * 1000 * 60;\n              syncSubscription = this.sync.start({\n                fullSyncInterval: fullSyncIntervalInMilliseconds\n              }).subscribe({\n                next: function (_a) {\n                  var type = _a.type,\n                    data = _a.data;\n                  // In Node, we need to wait for queries to be synced to prevent returning empty arrays.\n                  // In the Browser, we can begin returning data once subscriptions are in place.\n                  var readyType = isNode ? ControlMessage.SYNC_ENGINE_SYNC_QUERIES_READY : ControlMessage.SYNC_ENGINE_STORAGE_SUBSCRIBED;\n                  if (type === readyType) {\n                    _this.initResolve();\n                  }\n                  Hub.dispatch('datastore', {\n                    event: type,\n                    data: data\n                  });\n                },\n                error: function (err) {\n                  logger.warn('Sync error', err);\n                  _this.initReject();\n                }\n              });\n              return [3 /*break*/, 8];\n            case 7:\n              logger.warn(\"Data won't be synchronized. No GraphQL endpoint configured. Did you forget `Amplify.configure(awsconfig)`?\", {\n                config: this.amplifyConfig\n              });\n              this.initResolve();\n              _b.label = 8;\n            case 8:\n              return [4 /*yield*/, this.initialized];\n            case 9:\n              _b.sent();\n              return [2 /*return*/];\n          }\n        });\n      });\n    };\n    this.query = function (modelConstructor, idOrCriteria, paginationProducer) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var msg, modelDefinition, predicate, pagination, result;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              return [4 /*yield*/, this.start()];\n            case 1:\n              _a.sent();\n              //#region Input validation\n              if (!isValidModelConstructor(modelConstructor)) {\n                msg = 'Constructor is not for a valid model';\n                logger.error(msg, {\n                  modelConstructor: modelConstructor\n                });\n                throw new Error(msg);\n              }\n              if (typeof idOrCriteria === 'string') {\n                if (paginationProducer !== undefined) {\n                  logger.warn('Pagination is ignored when querying by id');\n                }\n              }\n              modelDefinition = getModelDefinition(modelConstructor);\n              if (isQueryOne(idOrCriteria)) {\n                predicate = ModelPredicateCreator.createForId(modelDefinition, idOrCriteria);\n              } else {\n                if (isPredicatesAll(idOrCriteria)) {\n                  // Predicates.ALL means \"all records\", so no predicate (undefined)\n                  predicate = undefined;\n                } else {\n                  predicate = ModelPredicateCreator.createFromExisting(modelDefinition, idOrCriteria);\n                }\n              }\n              pagination = this.processPagination(modelDefinition, paginationProducer);\n              //#endregion\n              logger.debug('params ready', {\n                modelConstructor: modelConstructor,\n                predicate: ModelPredicateCreator.getPredicates(predicate, false),\n                pagination: __assign(__assign({}, pagination), {\n                  sort: ModelSortPredicateCreator.getPredicates(pagination && pagination.sort, false)\n                })\n              });\n              return [4 /*yield*/, this.storage.query(modelConstructor, predicate, pagination)];\n            case 2:\n              result = _a.sent();\n              return [2 /*return*/, isQueryOne(idOrCriteria) ? result[0] : result];\n          }\n        });\n      });\n    };\n    this.save = function (model, condition) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var patchesTuple, modelConstructor, msg, modelDefinition, producedCondition, _a, savedModel;\n        var _this = this;\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              return [4 /*yield*/, this.start()];\n            case 1:\n              _b.sent();\n              patchesTuple = modelPatchesMap.get(model);\n              modelConstructor = model ? model.constructor : undefined;\n              if (!isValidModelConstructor(modelConstructor)) {\n                msg = 'Object is not an instance of a valid model';\n                logger.error(msg, {\n                  model: model\n                });\n                throw new Error(msg);\n              }\n              modelDefinition = getModelDefinition(modelConstructor);\n              producedCondition = ModelPredicateCreator.createFromExisting(modelDefinition, condition);\n              return [4 /*yield*/, this.storage.runExclusive(function (s) {\n                return __awaiter(_this, void 0, void 0, function () {\n                  return __generator(this, function (_a) {\n                    switch (_a.label) {\n                      case 0:\n                        return [4 /*yield*/, s.save(model, producedCondition, undefined, patchesTuple)];\n                      case 1:\n                        _a.sent();\n                        return [2 /*return*/, s.query(modelConstructor, ModelPredicateCreator.createForId(modelDefinition, model.id))];\n                    }\n                  });\n                });\n              })];\n            case 2:\n              _a = __read.apply(void 0, [_b.sent(), 1]), savedModel = _a[0];\n              return [2 /*return*/, savedModel];\n          }\n        });\n      });\n    };\n    this.setConflictHandler = function (config) {\n      var configDataStore = config.DataStore;\n      var conflictHandlerIsDefault = function () {\n        return _this.conflictHandler === defaultConflictHandler;\n      };\n      if (configDataStore) {\n        return configDataStore.conflictHandler;\n      }\n      if (conflictHandlerIsDefault() && config.conflictHandler) {\n        return config.conflictHandler;\n      }\n      return _this.conflictHandler || defaultConflictHandler;\n    };\n    this.setErrorHandler = function (config) {\n      var configDataStore = config.DataStore;\n      var errorHandlerIsDefault = function () {\n        return _this.errorHandler === defaultErrorHandler;\n      };\n      if (configDataStore) {\n        return configDataStore.errorHandler;\n      }\n      if (errorHandlerIsDefault() && config.errorHandler) {\n        return config.errorHandler;\n      }\n      return _this.errorHandler || defaultErrorHandler;\n    };\n    this.delete = function (modelOrConstructor, idOrCriteria) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var condition, msg, modelConstructor, msg, msg, _a, deleted, model, modelConstructor, msg, modelDefinition, idPredicate, msg, _b, _c, deleted;\n        return __generator(this, function (_d) {\n          switch (_d.label) {\n            case 0:\n              return [4 /*yield*/, this.start()];\n            case 1:\n              _d.sent();\n              if (!modelOrConstructor) {\n                msg = 'Model or Model Constructor required';\n                logger.error(msg, {\n                  modelOrConstructor: modelOrConstructor\n                });\n                throw new Error(msg);\n              }\n              if (!isValidModelConstructor(modelOrConstructor)) return [3 /*break*/, 3];\n              modelConstructor = modelOrConstructor;\n              if (!idOrCriteria) {\n                msg = 'Id to delete or criteria required. Do you want to delete all? Pass Predicates.ALL';\n                logger.error(msg, {\n                  idOrCriteria: idOrCriteria\n                });\n                throw new Error(msg);\n              }\n              if (typeof idOrCriteria === 'string') {\n                condition = ModelPredicateCreator.createForId(getModelDefinition(modelConstructor), idOrCriteria);\n              } else {\n                condition = ModelPredicateCreator.createFromExisting(getModelDefinition(modelConstructor),\n                /**\n                 * idOrCriteria is always a ProducerModelPredicate<T>, never a symbol.\n                 * The symbol is used only for typing purposes. e.g. see Predicates.ALL\n                 */\n                idOrCriteria);\n                if (!condition || !ModelPredicateCreator.isValidPredicate(condition)) {\n                  msg = 'Criteria required. Do you want to delete all? Pass Predicates.ALL';\n                  logger.error(msg, {\n                    condition: condition\n                  });\n                  throw new Error(msg);\n                }\n              }\n              return [4 /*yield*/, this.storage.delete(modelConstructor, condition)];\n            case 2:\n              _a = __read.apply(void 0, [_d.sent(), 1]), deleted = _a[0];\n              return [2 /*return*/, deleted];\n            case 3:\n              model = modelOrConstructor;\n              modelConstructor = Object.getPrototypeOf(model || {}).constructor;\n              if (!isValidModelConstructor(modelConstructor)) {\n                msg = 'Object is not an instance of a valid model';\n                logger.error(msg, {\n                  model: model\n                });\n                throw new Error(msg);\n              }\n              modelDefinition = getModelDefinition(modelConstructor);\n              idPredicate = ModelPredicateCreator.createForId(modelDefinition, model.id);\n              if (idOrCriteria) {\n                if (typeof idOrCriteria !== 'function') {\n                  msg = 'Invalid criteria';\n                  logger.error(msg, {\n                    idOrCriteria: idOrCriteria\n                  });\n                  throw new Error(msg);\n                }\n                condition = idOrCriteria(idPredicate);\n              } else {\n                condition = idPredicate;\n              }\n              return [4 /*yield*/, this.storage.delete(model, condition)];\n            case 4:\n              _b = __read.apply(void 0, [_d.sent(), 1]), _c = __read(_b[0], 1), deleted = _c[0];\n              return [2 /*return*/, deleted];\n          }\n        });\n      });\n    };\n    this.observe = function (modelOrConstructor, idOrCriteria) {\n      var predicate;\n      var modelConstructor = modelOrConstructor && isValidModelConstructor(modelOrConstructor) ? modelOrConstructor : undefined;\n      if (modelOrConstructor && modelConstructor === undefined) {\n        var model = modelOrConstructor;\n        var modelConstructor_1 = model && Object.getPrototypeOf(model).constructor;\n        if (isValidModelConstructor(modelConstructor_1)) {\n          if (idOrCriteria) {\n            logger.warn('idOrCriteria is ignored when using a model instance', {\n              model: model,\n              idOrCriteria: idOrCriteria\n            });\n          }\n          return _this.observe(modelConstructor_1, model.id);\n        } else {\n          var msg = 'The model is not an instance of a PersistentModelConstructor';\n          logger.error(msg, {\n            model: model\n          });\n          throw new Error(msg);\n        }\n      }\n      if (idOrCriteria !== undefined && modelConstructor === undefined) {\n        var msg = 'Cannot provide criteria without a modelConstructor';\n        logger.error(msg, idOrCriteria);\n        throw new Error(msg);\n      }\n      if (modelConstructor && !isValidModelConstructor(modelConstructor)) {\n        var msg = 'Constructor is not for a valid model';\n        logger.error(msg, {\n          modelConstructor: modelConstructor\n        });\n        throw new Error(msg);\n      }\n      if (typeof idOrCriteria === 'string') {\n        predicate = ModelPredicateCreator.createForId(getModelDefinition(modelConstructor), idOrCriteria);\n      } else {\n        predicate = modelConstructor && ModelPredicateCreator.createFromExisting(getModelDefinition(modelConstructor), idOrCriteria);\n      }\n      return new Observable(function (observer) {\n        var handle;\n        (function () {\n          return __awaiter(_this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n              switch (_a.label) {\n                case 0:\n                  return [4 /*yield*/, this.start()];\n                case 1:\n                  _a.sent();\n                  handle = this.storage.observe(modelConstructor, predicate).filter(function (_a) {\n                    var model = _a.model;\n                    return namespaceResolver(model) === USER;\n                  }).subscribe(observer);\n                  return [2 /*return*/];\n              }\n            });\n          });\n        })();\n        return function () {\n          if (handle) {\n            handle.unsubscribe();\n          }\n        };\n      });\n    };\n    this.configure = function (config) {\n      if (config === void 0) {\n        config = {};\n      }\n      var configDataStore = config.DataStore,\n        configAuthModeStrategyType = config.authModeStrategyType,\n        configConflictHandler = config.conflictHandler,\n        configErrorHandler = config.errorHandler,\n        configMaxRecordsToSync = config.maxRecordsToSync,\n        configSyncPageSize = config.syncPageSize,\n        configFullSyncInterval = config.fullSyncInterval,\n        configSyncExpressions = config.syncExpressions,\n        configFromAmplify = __rest(config, [\"DataStore\", \"authModeStrategyType\", \"conflictHandler\", \"errorHandler\", \"maxRecordsToSync\", \"syncPageSize\", \"fullSyncInterval\", \"syncExpressions\"]);\n      _this.amplifyConfig = __assign(__assign({}, configFromAmplify), _this.amplifyConfig);\n      _this.conflictHandler = _this.setConflictHandler(config);\n      _this.errorHandler = _this.setErrorHandler(config);\n      var authModeStrategyType = configDataStore && configDataStore.authModeStrategyType || configAuthModeStrategyType || AuthModeStrategyType.DEFAULT;\n      switch (authModeStrategyType) {\n        case AuthModeStrategyType.MULTI_AUTH:\n          _this.authModeStrategy = multiAuthStrategy;\n          break;\n        case AuthModeStrategyType.DEFAULT:\n          _this.authModeStrategy = defaultAuthStrategy;\n          break;\n        default:\n          _this.authModeStrategy = defaultAuthStrategy;\n          break;\n      }\n      _this.syncExpressions = configDataStore && configDataStore.syncExpressions || _this.syncExpressions || configSyncExpressions;\n      _this.maxRecordsToSync = configDataStore && configDataStore.maxRecordsToSync || _this.maxRecordsToSync || configMaxRecordsToSync;\n      _this.syncPageSize = configDataStore && configDataStore.syncPageSize || _this.syncPageSize || configSyncPageSize;\n      _this.fullSyncInterval = configDataStore && configDataStore.fullSyncInterval || _this.fullSyncInterval || configFullSyncInterval || 24 * 60; // 1 day\n      _this.sessionId = _this.retrieveSessionId();\n    };\n    this.clear = function clear() {\n      return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (this.storage === undefined) {\n                return [2 /*return*/];\n              }\n              if (syncSubscription && !syncSubscription.closed) {\n                syncSubscription.unsubscribe();\n              }\n              return [4 /*yield*/, this.storage.clear()];\n            case 1:\n              _a.sent();\n              if (this.sync) {\n                this.sync.unsubscribeConnectivity();\n              }\n              this.initialized = undefined; // Should re-initialize when start() is called.\n              this.storage = undefined;\n              this.sync = undefined;\n              this.syncPredicates = new WeakMap();\n              return [2 /*return*/];\n          }\n        });\n      });\n    };\n    this.stop = function stop() {\n      return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (!(this.initialized !== undefined)) return [3 /*break*/, 2];\n              return [4 /*yield*/, this.start()];\n            case 1:\n              _a.sent();\n              _a.label = 2;\n            case 2:\n              if (syncSubscription && !syncSubscription.closed) {\n                syncSubscription.unsubscribe();\n              }\n              if (this.sync) {\n                this.sync.unsubscribeConnectivity();\n              }\n              this.initialized = undefined; // Should re-initialize when start() is called.\n              this.sync = undefined;\n              return [2 /*return*/];\n          }\n        });\n      });\n    };\n  }\n  DataStore.prototype.getModuleName = function () {\n    return 'DataStore';\n  };\n  DataStore.prototype.processPagination = function (modelDefinition, paginationProducer) {\n    var sortPredicate;\n    var _a = paginationProducer || {},\n      limit = _a.limit,\n      page = _a.page,\n      sort = _a.sort;\n    if (limit === undefined && page === undefined && sort === undefined) {\n      return undefined;\n    }\n    if (page !== undefined && limit === undefined) {\n      throw new Error('Limit is required when requesting a page');\n    }\n    if (page !== undefined) {\n      if (typeof page !== 'number') {\n        throw new Error('Page should be a number');\n      }\n      if (page < 0) {\n        throw new Error(\"Page can't be negative\");\n      }\n    }\n    if (limit !== undefined) {\n      if (typeof limit !== 'number') {\n        throw new Error('Limit should be a number');\n      }\n      if (limit < 0) {\n        throw new Error(\"Limit can't be negative\");\n      }\n    }\n    if (sort) {\n      sortPredicate = ModelSortPredicateCreator.createFromExisting(modelDefinition, paginationProducer.sort);\n    }\n    return {\n      limit: limit,\n      page: page,\n      sort: sortPredicate\n    };\n  };\n  DataStore.prototype.processSyncExpressions = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var syncPredicates;\n      var _this = this;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!this.syncExpressions || !this.syncExpressions.length) {\n              return [2 /*return*/, new WeakMap()];\n            }\n            return [4 /*yield*/, Promise.all(this.syncExpressions.map(function (syncExpression) {\n              return __awaiter(_this, void 0, void 0, function () {\n                var _a, modelConstructor, conditionProducer, modelDefinition, condition, predicate;\n                return __generator(this, function (_b) {\n                  switch (_b.label) {\n                    case 0:\n                      return [4 /*yield*/, syncExpression];\n                    case 1:\n                      _a = _b.sent(), modelConstructor = _a.modelConstructor, conditionProducer = _a.conditionProducer;\n                      modelDefinition = getModelDefinition(modelConstructor);\n                      return [4 /*yield*/, this.unwrapPromise(conditionProducer)];\n                    case 2:\n                      condition = _b.sent();\n                      if (isPredicatesAll(condition)) {\n                        return [2 /*return*/, [modelDefinition, null]];\n                      }\n                      predicate = this.createFromCondition(modelDefinition, condition);\n                      return [2 /*return*/, [modelDefinition, predicate]];\n                  }\n                });\n              });\n            }))];\n          case 1:\n            syncPredicates = _a.sent();\n            return [2 /*return*/, this.weakMapFromEntries(syncPredicates)];\n        }\n      });\n    });\n  };\n  DataStore.prototype.createFromCondition = function (modelDefinition, condition) {\n    try {\n      return ModelPredicateCreator.createFromExisting(modelDefinition, condition);\n    } catch (error) {\n      logger.error('Error creating Sync Predicate');\n      throw error;\n    }\n  };\n  DataStore.prototype.unwrapPromise = function (conditionProducer) {\n    return __awaiter(this, void 0, void 0, function () {\n      var condition, error_1;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 2,, 3]);\n            return [4 /*yield*/, conditionProducer()];\n          case 1:\n            condition = _a.sent();\n            return [2 /*return*/, condition];\n          case 2:\n            error_1 = _a.sent();\n            if (error_1 instanceof TypeError) {\n              return [2 /*return*/, conditionProducer];\n            }\n            throw error_1;\n          case 3:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  DataStore.prototype.weakMapFromEntries = function (entries) {\n    return entries.reduce(function (map, _a) {\n      var _b = __read(_a, 2),\n        modelDefinition = _b[0],\n        predicate = _b[1];\n      if (map.has(modelDefinition)) {\n        var name_2 = modelDefinition.name;\n        logger.warn(\"You can only utilize one Sync Expression per model.\\n          Subsequent sync expressions for the \" + name_2 + \" model will be ignored.\");\n        return map;\n      }\n      if (predicate) {\n        map.set(modelDefinition, predicate);\n      }\n      return map;\n    }, new WeakMap());\n  };\n  // database separation for Amplify Console. Not a public API\n  DataStore.prototype.retrieveSessionId = function () {\n    try {\n      var sessionId = sessionStorage.getItem('datastoreSessionId');\n      if (sessionId) {\n        var aws_appsync_graphqlEndpoint = this.amplifyConfig.aws_appsync_graphqlEndpoint;\n        var appSyncUrl = aws_appsync_graphqlEndpoint.split('/')[2];\n        var _a = __read(appSyncUrl.split('.'), 1),\n          appSyncId = _a[0];\n        return sessionId + \"-\" + appSyncId;\n      }\n    } catch (_b) {\n      return undefined;\n    }\n  };\n  return DataStore;\n}();\nvar instance = new DataStore();\nAmplify.register(instance);\nexport { DataStore as DataStoreClass, initSchema, instance as DataStore };","map":{"version":3,"names":["Amplify","ConsoleLogger","Logger","Hub","JS","immerable","produce","setAutoFreeze","enablePatches","v4","uuid4","Observable","defaultAuthStrategy","multiAuthStrategy","isPredicatesAll","ModelPredicateCreator","ModelSortPredicateCreator","ExclusiveStorage","Storage","ControlMessage","SyncEngine","GraphQLScalarType","isGraphQLScalarType","AuthModeStrategyType","DATASTORE","establishRelation","exhaustiveCheck","isModelConstructor","monotonicUlidFactory","STORAGE","SYNC","USER","isNullOrUndefined","logger","ulid","Date","now","isNode","browserOrNode","SETTING_SCHEMA_VERSION","schema","modelNamespaceMap","WeakMap","modelPatchesMap","getModelDefinition","modelConstructor","namespace","get","namespaces","models","name","isValidModelConstructor","obj","has","namespaceResolver","syncClasses","userClasses","dataStoreClasses","storageClasses","initSchema","userSchema","undefined","console","warn","log","internalUserNamespace","__assign","createTypeClasses","dataStoreNamespace","getNamespace","storageNamespace","syncNamespace","_a","version","Object","keys","forEach","relationships","modelAssociations","Map","values","model","connectedModels","fields","filter","field","association","connectionType","type","push","set","result","count","size","Error","_b","e_1","__values","Array","from","_c","next","done","modelName","value","parents","every","x","delete","modelTopologicalOrdering","classes","entries","__read","modelDefinition","clazz","createModelClass","nonModels","typeName","typeDefinition","createNonModelClass","instancesMetadata","WeakSet","modelInstanceCreator","init","add","validateModelFields","k","v","fieldDefinition","isRequired_1","isRequired","isArrayNullable","name_1","isArray","jsType_1","getJSType","validateScalar_1","getValidationFunction","errorTypeText","some","e","elemTypes","map","join","validationStatus","s","initializeInstance","draft","modelValidator","Model","instance","modelInstanceMetadata","_id","id","_version","_lastChangedAt","_deleted","syncable","copyOf","source","fn","getPrototypeOf","constructor","msg","error","patches","p","length","fromJSON","json","_this","defineProperty","isQueryOne","defaultConflictHandler","conflictData","localModel","remoteModel","defaultErrorHandler","getModelConstructorByModelName","namespaceName","checkSchemaVersion","storage","Setting","runExclusive","__awaiter","query","createFromExisting","c","key","page","limit","apply","sent","schemaVersionSetting","storedValue","JSON","parse","clear","save","stringify","syncSubscription","enums","pluralName","DataStore","amplifyConfig","syncPredicates","start","initialized","debug","Promise","res","rej","initResolve","initReject","sessionId","aws_appsync_graphqlEndpoint","processSyncExpressions","sync","maxRecordsToSync","syncPageSize","conflictHandler","errorHandler","authModeStrategy","fullSyncIntervalInMilliseconds","fullSyncInterval","subscribe","data","readyType","SYNC_ENGINE_SYNC_QUERIES_READY","SYNC_ENGINE_STORAGE_SUBSCRIBED","dispatch","event","err","config","idOrCriteria","paginationProducer","predicate","createForId","pagination","processPagination","getPredicates","sort","condition","patchesTuple","producedCondition","savedModel","setConflictHandler","configDataStore","conflictHandlerIsDefault","setErrorHandler","errorHandlerIsDefault","modelOrConstructor","_d","isValidPredicate","deleted","idPredicate","observe","modelConstructor_1","observer","handle","unsubscribe","configure","configAuthModeStrategyType","authModeStrategyType","configConflictHandler","configErrorHandler","configMaxRecordsToSync","configSyncPageSize","configFullSyncInterval","configSyncExpressions","syncExpressions","configFromAmplify","__rest","DEFAULT","MULTI_AUTH","retrieveSessionId","closed","unsubscribeConnectivity","stop","prototype","getModuleName","sortPredicate","all","syncExpression","conditionProducer","unwrapPromise","createFromCondition","weakMapFromEntries","error_1","TypeError","reduce","name_2","sessionStorage","getItem","appSyncUrl","split","appSyncId","register","DataStoreClass"],"sources":["../../src/datastore/datastore.ts"],"sourcesContent":[null],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,SAASA,OAAO,EAAEC,aAAa,IAAIC,MAAM,EAAEC,GAAG,EAAEC,EAAE,QAAQ,mBAAmB;AAC7E,SAECC,SAAS,EACTC,OAAO,EACPC,aAAa,EACbC,aAAa,QAEP,OAAO;AACd,SAASC,EAAE,IAAIC,KAAK,QAAQ,MAAM;AAClC,OAAOC,UAA6B,MAAM,mBAAmB;AAC7D,SAASC,mBAAmB,EAAEC,iBAAiB,QAAQ,uBAAuB;AAC9E,SACCC,eAAe,EACfC,qBAAqB,EACrBC,yBAAyB,QAEnB,eAAe;AACtB,SAASC,gBAAgB,IAAIC,OAAO,QAAQ,oBAAoB;AAChE,SAASC,cAAc,EAAEC,UAAU,QAAQ,SAAS;AACpD,SAICC,iBAAiB,EAEjBC,mBAAmB,EAwBnBC,oBAAoB,QACd,UAAU;AACjB,SACCC,SAAS,EACTC,iBAAiB,EACjBC,eAAe,EACfC,kBAAkB,EAClBC,oBAAoB,EAEpBC,OAAO,EACPC,IAAI,EACJC,IAAI,EACJC,iBAAiB,QACX,SAAS;AAEhBzB,aAAa,CAAC,IAAI,CAAC;AACnBC,aAAa,EAAE;AAEf,IAAMyB,MAAM,GAAG,IAAI/B,MAAM,CAAC,WAAW,CAAC;AAEtC,IAAMgC,IAAI,GAAGN,oBAAoB,CAACO,IAAI,CAACC,GAAG,EAAE,CAAC;AACrC,IAAAC,MAAA,GAAAjC,EAAA,CAAAkC,aAAA,GAAAD,MAAM;AAad,IAAME,sBAAsB,GAAG,eAAe;AAE9C,IAAIC,MAAsB;AAC1B,IAAMC,iBAAiB,GAAG,IAAIC,OAAO,EAGlC;AACH;AACA;AACA;AACA,IAAMC,eAAe,GAAG,IAAID,OAAO,EAGhC;AAEH,IAAME,kBAAkB,GAAG,SAAAA,CAC1BC,gBAAiD;EAEjD,IAAMC,SAAS,GAAGL,iBAAiB,CAACM,GAAG,CAACF,gBAAgB,CAAC;EAEzD,OAAOL,MAAM,CAACQ,UAAU,CAACF,SAAS,CAAC,CAACG,MAAM,CAACJ,gBAAgB,CAACK,IAAI,CAAC;AAClE,CAAC;AAED,IAAMC,uBAAuB,GAAG,SAAAA,CAC/BC,GAAQ;EAER,OAAOzB,kBAAkB,CAACyB,GAAG,CAAC,IAAIX,iBAAiB,CAACY,GAAG,CAACD,GAAG,CAAC;AAC7D,CAAC;AAED,IAAME,iBAAiB,GAAsB,SAAAA,CAAAT,gBAAgB;EAC5D,OAAAJ,iBAAiB,CAACM,GAAG,CAACF,gBAAgB,CAAC;AAAvC,CAAuC;AAExC;AACA,OAAO,IAAIU,WAA+B;AAC1C,IAAIC,WAA+B;AACnC,IAAIC,gBAAoC;AACxC,IAAIC,cAAkC;AAEtC,IAAMC,UAAU,GAAG,SAAAA,CAACC,UAAkB;;EACrC,IAAIpB,MAAM,KAAKqB,SAAS,EAAE;IACzBC,OAAO,CAACC,IAAI,CAAC,yCAAyC,CAAC;IAEvD,OAAOP,WAAW;;EAGnBvB,MAAM,CAAC+B,GAAG,CAAC,mBAAmB,EAAE;IAAExB,MAAM,EAAEoB;EAAU,CAAE,CAAC;EAEvD,IAAMK,qBAAqB,GAAAC,QAAA;IAC1BhB,IAAI,EAAEnB;EAAI,GACP6B,UAAU,CACb;EAED3B,MAAM,CAAC+B,GAAG,CAAC,WAAW,EAAE,aAAa,CAAC;EACtCR,WAAW,GAAGW,iBAAiB,CAACF,qBAAqB,CAAC;EACtDhC,MAAM,CAAC+B,GAAG,CAAC,WAAW,EAAE,oBAAoB,CAAC;EAE7C,IAAMI,kBAAkB,GAAGC,YAAY,EAAE;EACzC,IAAMC,gBAAgB,GAAGpD,OAAO,CAACmD,YAAY,EAAE;EAC/C,IAAME,aAAa,GAAGnD,UAAU,CAACiD,YAAY,EAAE;EAE/CZ,gBAAgB,GAAGU,iBAAiB,CAACC,kBAAkB,CAAC;EACxDV,cAAc,GAAGS,iBAAiB,CAACG,gBAAgB,CAAC;EACpDf,WAAW,GAAGY,iBAAiB,CAACI,aAAa,CAAC;EAE9C/B,MAAM,GAAG;IACRQ,UAAU,GAAAwB,EAAA,OACTA,EAAA,CAACJ,kBAAkB,CAAClB,IAAI,IAAGkB,kBAAkB,EAC7CI,EAAA,CAACP,qBAAqB,CAACf,IAAI,IAAGe,qBAAqB,EACnDO,EAAA,CAACF,gBAAgB,CAACpB,IAAI,IAAGoB,gBAAgB,EACzCE,EAAA,CAACD,aAAa,CAACrB,IAAI,IAAGqB,aAAa,E,GACnC;IACDE,OAAO,EAAEb,UAAU,CAACa;GACpB;EAEDC,MAAM,CAACC,IAAI,CAACnC,MAAM,CAACQ,UAAU,CAAC,CAAC4B,OAAO,CAAC,UAAA9B,SAAS;;IAC/CN,MAAM,CAACQ,UAAU,CAACF,SAAS,CAAC,CAAC+B,aAAa,GAAGpD,iBAAiB,CAC7De,MAAM,CAACQ,UAAU,CAACF,SAAS,CAAC,CAC5B;IAED,IAAMgC,iBAAiB,GAAG,IAAIC,GAAG,EAAoB;IAErDL,MAAM,CAACM,MAAM,CAACxC,MAAM,CAACQ,UAAU,CAACF,SAAS,CAAC,CAACG,MAAM,CAAC,CAAC2B,OAAO,CAAC,UAAAK,KAAK;MAC/D,IAAMC,eAAe,GAAa,EAAE;MAEpCR,MAAM,CAACM,MAAM,CAACC,KAAK,CAACE,MAAM,CAAC,CACzBC,MAAM,CACN,UAAAC,KAAK;QACJ,OAAAA,KAAK,CAACC,WAAW,IACjBD,KAAK,CAACC,WAAW,CAACC,cAAc,KAAK,YAAY,IAChCF,KAAK,CAACG,IAAK,CAACP,KAAK,KAAKA,KAAK,CAAC/B,IAAI;MAFjD,CAEiD,CAClD,CACA0B,OAAO,CAAC,UAAAS,KAAK;QACb,OAAAH,eAAe,CAACO,IAAI,CAAkBJ,KAAK,CAACG,IAAK,CAACP,KAAK,CAAC;MAAxD,CAAwD,CACxD;MAEFH,iBAAiB,CAACY,GAAG,CAACT,KAAK,CAAC/B,IAAI,EAAEgC,eAAe,CAAC;IACnD,CAAC,CAAC;IAEF,IAAMS,MAAM,GAAG,IAAIZ,GAAG,EAAoB;IAE1C,IAAIa,KAAK,GAAG,IAAI;IAChB,OAAO,IAAI,IAAIA,KAAK,GAAG,CAAC,EAAE;MACzB,IAAId,iBAAiB,CAACe,IAAI,KAAK,CAAC,EAAE;QACjC;;MAEDD,KAAK,EAAE;MACP,IAAIA,KAAK,KAAK,CAAC,EAAE;QAChB,MAAM,IAAIE,KAAK,CACd,mEAAmE,CACnE;;;QAGF,KAAwB,IAAAC,EAAA,IAAAC,GAAA,WAAAC,QAAA,CAAAC,KAAK,CAACC,IAAI,CAACrB,iBAAiB,CAACH,IAAI,EAAE,CAAC,IAAAyB,EAAA,GAAAL,EAAA,CAAAM,IAAA,KAAAD,EAAA,CAAAE,IAAA,EAAAF,EAAA,GAAAL,EAAA,CAAAM,IAAA,IAAE;UAAzD,IAAME,SAAS,GAAAH,EAAA,CAAAI,KAAA;UACnB,IAAMC,OAAO,GAAG3B,iBAAiB,CAAC/B,GAAG,CAACwD,SAAS,CAAC;UAEhD,IAAIE,OAAO,CAACC,KAAK,CAAC,UAAAC,CAAC;YAAI,OAAAhB,MAAM,CAACtC,GAAG,CAACsD,CAAC,CAAC;UAAb,CAAa,CAAC,EAAE;YACtChB,MAAM,CAACD,GAAG,CAACa,SAAS,EAAEE,OAAO,CAAC;;;;;;;;;;;;;;MAIhCP,KAAK,CAACC,IAAI,CAACR,MAAM,CAAChB,IAAI,EAAE,CAAC,CAACC,OAAO,CAAC,UAAA+B,CAAC;QAAI,OAAA7B,iBAAiB,CAAC8B,MAAM,CAACD,CAAC,CAAC;MAA3B,CAA2B,CAAC;;IAGpEnE,MAAM,CAACQ,UAAU,CAACF,SAAS,CAAC,CAAC+D,wBAAwB,GAAGlB,MAAM;EAC/D,CAAC,CAAC;EAEF,OAAOnC,WAAW;AACnB,CAAC;AAED,IAAMW,iBAAiB,GAEG,SAAAA,CAAArB,SAAS;EAClC,IAAMgE,OAAO,GAAuB,EAAE;EAEtCpC,MAAM,CAACqC,OAAO,CAACjE,SAAS,CAACG,MAAM,CAAC,CAAC2B,OAAO,CAAC,UAACJ,EAA4B;QAA5BuB,EAAA,GAAAiB,MAAA,CAAAxC,EAAA,IAA4B;MAA3B+B,SAAA,GAAAR,EAAA,GAAS;MAAEkB,eAAA,GAAAlB,EAAA,GAAe;IACpE,IAAMmB,KAAK,GAAGC,gBAAgB,CAACF,eAAe,CAAC;IAC/CH,OAAO,CAACP,SAAS,CAAC,GAAGW,KAAK;IAE1BzE,iBAAiB,CAACiD,GAAG,CAACwB,KAAK,EAAEpE,SAAS,CAACI,IAAI,CAAC;EAC7C,CAAC,CAAC;EAEFwB,MAAM,CAACqC,OAAO,CAACjE,SAAS,CAACsE,SAAS,IAAI,EAAE,CAAC,CAACxC,OAAO,CAChD,UAACJ,EAA0B;QAA1BuB,EAAA,GAAAiB,MAAA,CAAAxC,EAAA,IAA0B;MAAzB6C,QAAA,GAAAtB,EAAA,GAAQ;MAAEuB,cAAA,GAAAvB,EAAA,GAAc;IACzB,IAAMmB,KAAK,GAAGK,mBAAmB,CAACD,cAAc,CAAC;IACjDR,OAAO,CAACO,QAAQ,CAAC,GAAGH,KAAK;EAC1B,CAAC,CACD;EAED,OAAOJ,OAAO;AACf,CAAC;AAID,IAAMU,iBAAiB,GAAG,IAAIC,OAAO,EAElC;AACH,SAASC,oBAAoBA,CAC5B7E,gBAA+C,EAC/C8E,IAAmD;EAEnDH,iBAAiB,CAACI,GAAG,CAACD,IAAI,CAAC;EAE3B,OAAU,IAAI9E,gBAAgB,CAAC8E,IAAI,CAAC;AACrC;AAEA,IAAME,mBAAmB,GAAG,SAAAA,CAACZ,eAA6C;EAAK,iBAC9Ea,CAAS,EACTC,CAAM;IAEN,IAAMC,eAAe,GAAGf,eAAe,CAAC9B,MAAM,CAAC2C,CAAC,CAAC;IAEjD,IAAIE,eAAe,KAAKnE,SAAS,EAAE;MAEjC,IAAA2B,IAAA,GAAAwC,eAAA,CAAAxC,IAAI;QACJyC,YAAA,GAAAD,eAAA,CAAAE,UAAU;QACVC,eAAA,GAAAH,eAAA,CAAAG,eAAe;QACfC,MAAA,GAAAJ,eAAA,CAAA9E,IAAI;QACJmF,OAAA,GAAAL,eAAA,CAAAK,OAAO;MAGR,IACC,CAAE,CAACA,OAAO,IAAIJ,YAAU,IAAMI,OAAO,IAAI,CAACF,eAAgB,MACzDJ,CAAC,KAAK,IAAI,IAAIA,CAAC,KAAKlE,SAAS,CAAC,EAC9B;QACD,MAAM,IAAIiC,KAAK,CAAC,WAASsC,MAAI,iBAAc,CAAC;;MAG7C,IAAI9G,mBAAmB,CAACkE,IAAI,CAAC,EAAE;QAC9B,IAAM8C,QAAM,GAAGjH,iBAAiB,CAACkH,SAAS,CAAC/C,IAAI,CAAC;QAChD,IAAMgD,gBAAc,GAAGnH,iBAAiB,CAACoH,qBAAqB,CAACjD,IAAI,CAAC;QAEpE,IAAI6C,OAAO,EAAE;UACZ,IAAIK,aAAa,GAAWJ,QAAM;UAClC,IAAI,CAACL,YAAU,EAAE;YAChBS,aAAa,GAAMJ,QAAM,wBAAqB;;UAG/C,IAAI,CAACpC,KAAK,CAACmC,OAAO,CAACN,CAAC,CAAC,IAAI,CAACI,eAAe,EAAE;YAC1C,MAAM,IAAIrC,KAAK,CACd,WAASsC,MAAI,4BAAuBM,aAAa,WAAM,OAAOX,CAAC,mBAAcA,CAAG,CAChF;;UAGF,IACC,CAAC/F,iBAAiB,CAAC+F,CAAC,CAAC,IAChBA,CAAE,CAACY,IAAI,CAAC,UAAAC,CAAC;YACb,OAAA5G,iBAAiB,CAAC4G,CAAC,CAAC,GAAGX,YAAU,GAAG,OAAOW,CAAC,KAAKN,QAAM;UAAvD,CAAuD,CACvD,EACA;YACD,IAAMO,SAAS,GAAQd,CAAE,CACvBe,GAAG,CAAC,UAAAF,CAAC;cAAI,OAACA,CAAC,KAAK,IAAI,GAAG,MAAM,GAAG,OAAOA,CAAC;YAA/B,CAAgC,CAAC,CAC1CG,IAAI,CAAC,GAAG,CAAC;YAEX,MAAM,IAAIjD,KAAK,CACd,yBAAuBsC,MAAI,iCAA4BM,aAAa,WAAMG,SAAS,oBAAed,CAAG,CACrG;;UAGF,IAAIS,gBAAc,IAAI,CAACxG,iBAAiB,CAAC+F,CAAC,CAAC,EAAE;YAC5C,IAAMiB,gBAAgB,GAAQjB,CAAE,CAACe,GAAG,CAAC,UAAAF,CAAC;cACrC,IAAI,CAAC5G,iBAAiB,CAAC4G,CAAC,CAAC,EAAE;gBAC1B,OAAOJ,gBAAc,CAACI,CAAC,CAAC;eACxB,MAAM,IAAI5G,iBAAiB,CAAC4G,CAAC,CAAC,IAAI,CAACX,YAAU,EAAE;gBAC/C,OAAO,IAAI;eACX,MAAM;gBACN,OAAO,KAAK;;YAEd,CAAC,CAAC;YAEF,IAAI,CAACe,gBAAgB,CAACtC,KAAK,CAAC,UAAAuC,CAAC;cAAI,OAAAA,CAAC;YAAD,CAAC,CAAC,EAAE;cACpC,MAAM,IAAInD,KAAK,CACd,yBAAuBsC,MAAI,iCAA4B5C,IAAI,sDAAiDuC,CAAG,CAC/G;;;SAGH,MAAM,IAAI,CAACE,YAAU,IAAIF,CAAC,KAAKlE,SAAS,EAAE;UAC1C;SACA,MAAM,IAAI,OAAOkE,CAAC,KAAKO,QAAM,IAAIP,CAAC,KAAK,IAAI,EAAE;UAC7C,MAAM,IAAIjC,KAAK,CACd,WAASsC,MAAI,2BAAsBE,QAAM,UAAK,OAAOP,CAAC,mBAAcA,CAAG,CACvE;SACD,MAAM,IACN,CAAC/F,iBAAiB,CAAC+F,CAAC,CAAC,IACrBS,gBAAc,IACd,CAACA,gBAAc,CAACT,CAAC,CAAC,EACjB;UACD,MAAM,IAAIjC,KAAK,CACd,WAASsC,MAAI,2BAAsB5C,IAAI,6BAAwBuC,CAAG,CAClE;;;;EAIL,CAAC;AAvF8E,CAuF9E;AAED,IAAMmB,kBAAkB,GAAG,SAAAA,CAC1BvB,IAAkB,EAClBV,eAA6C,EAC7CkC,KAAuC;EAEvC,IAAMC,cAAc,GAAGvB,mBAAmB,CAACZ,eAAe,CAAC;EAC3DvC,MAAM,CAACqC,OAAO,CAACY,IAAI,CAAC,CAAC/C,OAAO,CAAC,UAACJ,EAAM;QAANuB,EAAA,GAAAiB,MAAA,CAAAxC,EAAA,IAAM;MAALsD,CAAA,GAAA/B,EAAA,GAAC;MAAEgC,CAAA,GAAAhC,EAAA,GAAC;IAClCqD,cAAc,CAACtB,CAAC,EAAEC,CAAC,CAAC;IACdoB,KAAM,CAACrB,CAAC,CAAC,GAAGC,CAAC;EACpB,CAAC,CAAC;AACH,CAAC;AAED,IAAMZ,gBAAgB,GAAG,SAAAA,CACxBF,eAA4B;EAE5B,IAAMC,KAAK,GAAmC;IAC7C,SAAAmC,MAAY1B,IAAkB;MAC7B,IAAM2B,QAAQ,GAAGhJ,OAAO,CACvB,IAAI,EACJ,UAAC6I,KAAuC;QACvCD,kBAAkB,CAACvB,IAAI,EAAEV,eAAe,EAAEkC,KAAK,CAAC;QAEhD,IAAMI,qBAAqB,GAA0B/B,iBAAiB,CAACnE,GAAG,CACzEsE,IAAI,CACJ,GACmCA,IAAK,GACf,EAAE;QAE3B,IAAA6B,GAAA,GAAAD,qBAAA,CAAAE,EAAO;UACPC,QAAA,GAAAH,qBAAA,CAAAG,QAAQ;UACRC,cAAA,GAAAJ,qBAAA,CAAAI,cAAc;UACdC,QAAA,GAAAL,qBAAA,CAAAK,QAAQ;QAGT,IAAMH,EAAE;QACP;QACAD,GAAG,KAAK,IAAI,IAAIA,GAAG,KAAK3F,SAAS,GAC9B2F,GAAG,GACHvC,eAAe,CAAC4C,QAAQ,GACxBnJ,KAAK,EAAE,GACPwB,IAAI,EAAE;QAEViH,KAAK,CAACM,EAAE,GAAGA,EAAE;QAEb,IAAIxC,eAAe,CAAC4C,QAAQ,EAAE;UAC7BV,KAAK,CAACO,QAAQ,GAAGA,QAAQ;UACzBP,KAAK,CAACQ,cAAc,GAAGA,cAAc;UACrCR,KAAK,CAACS,QAAQ,GAAGA,QAAQ;;MAE3B,CAAC,CACD;MAED,OAAON,QAAQ;IAChB;IAEOD,KAAA,CAAAS,MAAM,GAAb,UAAcC,MAAS,EAAEC,EAAiC;MACzD,IAAMnH,gBAAgB,GAAG6B,MAAM,CAACuF,cAAc,CAACF,MAAM,IAAI,EAAE,CAAC,CAACG,WAAW;MACxE,IAAI,CAAC/G,uBAAuB,CAACN,gBAAgB,CAAC,EAAE;QAC/C,IAAMsH,GAAG,GAAG,wCAAwC;QACpDlI,MAAM,CAACmI,KAAK,CAACD,GAAG,EAAE;UAAEJ,MAAM,EAAAA;QAAA,CAAE,CAAC;QAC7B,MAAM,IAAIjE,KAAK,CAACqE,GAAG,CAAC;;MAGrB,IAAIE,OAAO;MACX,IAAMpF,KAAK,GAAG3E,OAAO,CACpByJ,MAAM,EACN,UAAAZ,KAAK;QACJa,EAAE,CAAkBb,KAAK,CAAC;QAC1BA,KAAK,CAACM,EAAE,GAAGM,MAAM,CAACN,EAAE;QACpB,IAAML,cAAc,GAAGvB,mBAAmB,CAACZ,eAAe,CAAC;QAC3DvC,MAAM,CAACqC,OAAO,CAACoC,KAAK,CAAC,CAACvE,OAAO,CAAC,UAACJ,EAAM;cAANuB,EAAA,GAAAiB,MAAA,CAAAxC,EAAA,IAAM;YAALsD,CAAA,GAAA/B,EAAA,GAAC;YAAEgC,CAAA,GAAAhC,EAAA,GAAC;UACnCqD,cAAc,CAACtB,CAAC,EAAEC,CAAC,CAAC;QACrB,CAAC,CAAC;MACH,CAAC,EACD,UAAAuC,CAAC;QAAI,OAACD,OAAO,GAAGC,CAAC;MAAZ,CAAa,CAClB;MAED,IAAID,OAAO,CAACE,MAAM,EAAE;QACnB5H,eAAe,CAAC+C,GAAG,CAACT,KAAK,EAAE,CAACoF,OAAO,EAAEN,MAAM,CAAC,CAAC;;MAG9C,OAAO9E,KAAK;IACb,CAAC;IAED;IACA;IACOoE,KAAA,CAAAmB,QAAQ,GAAf,UAAgBC,IAAa;MAA7B,IAAAC,KAAA;MACC,IAAIxE,KAAK,CAACmC,OAAO,CAACoC,IAAI,CAAC,EAAE;QACxB,OAAOA,IAAI,CAAC3B,GAAG,CAAC,UAAAnB,IAAI;UAAI,OAAA+C,KAAI,CAACF,QAAQ,CAAC7C,IAAI,CAAC;QAAnB,CAAmB,CAAC;;MAG7C,IAAM2B,QAAQ,GAAG5B,oBAAoB,CAACR,KAAK,EAAEuD,IAAI,CAAC;MAClD,IAAMrB,cAAc,GAAGvB,mBAAmB,CAACZ,eAAe,CAAC;MAE3DvC,MAAM,CAACqC,OAAO,CAACuC,QAAQ,CAAC,CAAC1E,OAAO,CAAC,UAACJ,EAAM;YAANuB,EAAA,GAAAiB,MAAA,CAAAxC,EAAA,IAAM;UAALsD,CAAA,GAAA/B,EAAA,GAAC;UAAEgC,CAAA,GAAAhC,EAAA,GAAC;QACtCqD,cAAc,CAACtB,CAAC,EAAEC,CAAC,CAAC;MACrB,CAAC,CAAC;MAEF,OAAOuB,QAAQ;IAChB,CAAC;IACF,OAAAD,KAAC;EAAD,CAAC,CArFsD,CAqFrD;EAEFnC,KAAK,CAAC7G,SAAS,CAAC,GAAG,IAAI;EAEvBqE,MAAM,CAACiG,cAAc,CAACzD,KAAK,EAAE,MAAM,EAAE;IAAEV,KAAK,EAAES,eAAe,CAAC/D;EAAI,CAAE,CAAC;EAErE,OAAOgE,KAAK;AACb,CAAC;AAED,IAAMK,mBAAmB,GAAG,SAAAA,CAAID,cAA8B;EAC7D,IAAMJ,KAAK,GAAgC;IAC1C,SAAAmC,MAAY1B,IAAkB;MAC7B,IAAM2B,QAAQ,GAAGhJ,OAAO,CACvB,IAAI,EACJ,UAAC6I,KAAuC;QACvCD,kBAAkB,CAACvB,IAAI,EAAEL,cAAc,EAAE6B,KAAK,CAAC;MAChD,CAAC,CACD;MAED,OAAOG,QAAQ;IAChB;IACD,OAAAD,KAAC;EAAD,CAAC,CAXmD,CAWlD;EAEFnC,KAAK,CAAC7G,SAAS,CAAC,GAAG,IAAI;EAEvBqE,MAAM,CAACiG,cAAc,CAACzD,KAAK,EAAE,MAAM,EAAE;IAAEV,KAAK,EAAEc,cAAc,CAACpE;EAAI,CAAE,CAAC;EAEpE,OAAOgE,KAAK;AACb,CAAC;AAED,SAAS0D,UAAUA,CAACxH,GAAQ;EAC3B,OAAO,OAAOA,GAAG,KAAK,QAAQ;AAC/B;AAEA,SAASyH,sBAAsBA,CAACC,YAA0B;EACjD,IAAAC,UAAA,GAAAD,YAAA,CAAAC,UAAU;IAAElI,gBAAA,GAAAiI,YAAA,CAAAjI,gBAAgB;IAAEmI,WAAA,GAAAF,YAAA,CAAAE,WAAW;EACzC,IAAAtB,QAAA,GAAAsB,WAAA,CAAAtB,QAAQ;EAChB,OAAOhC,oBAAoB,CAAC7E,gBAAgB,EAAAqB,QAAA,CAAAA,QAAA,KAAO6G,UAAU;IAAErB,QAAQ,EAAAA;EAAA,GAAG;AAC3E;AAEA,SAASuB,mBAAmBA,CAACb,KAAgB;EAC5CnI,MAAM,CAAC8B,IAAI,CAACqG,KAAK,CAAC;AACnB;AAEA,SAASc,8BAA8BA,CACtCC,aAAyB,EACzB5E,SAAiB;EAEjB,IAAIZ,MAAsE;EAE1E,QAAQwF,aAAa;IACpB,KAAK3J,SAAS;MACbmE,MAAM,GAAGlC,gBAAgB,CAAC8C,SAAS,CAAC;MACpC;IACD,KAAKxE,IAAI;MACR4D,MAAM,GAAGnC,WAAW,CAAC+C,SAAS,CAAC;MAC/B;IACD,KAAKzE,IAAI;MACR6D,MAAM,GAAGpC,WAAW,CAACgD,SAAS,CAAC;MAC/B;IACD,KAAK1E,OAAO;MACX8D,MAAM,GAAGjC,cAAc,CAAC6C,SAAS,CAAC;MAClC;IACD;MACC7E,eAAe,CAACyJ,aAAa,CAAC;MAC9B;;EAGF,IAAIhI,uBAAuB,CAACwC,MAAM,CAAC,EAAE;IACpC,OAAOA,MAAM;GACb,MAAM;IACN,IAAMwE,GAAG,GAAG,uDAAqD5D,SAAS,qBAAgB4E,aAAe;IACzGlJ,MAAM,CAACmI,KAAK,CAACD,GAAG,CAAC;IAEjB,MAAM,IAAIrE,KAAK,CAACqE,GAAG,CAAC;;AAEtB;AAEA,SAAeiB,kBAAkBA,CAChCC,OAAgB,EAChB5G,OAAe;;;;;;;UAET6G,OAAO,GAAG7H,gBAAgB,CAAC6H,OAEhC;UAEKrE,eAAe,GAAGzE,MAAM,CAACQ,UAAU,CAACxB,SAAS,CAAC,CAACyB,MAAM,CAACqI,OAAO;UAEnE,qBAAMD,OAAO,CAACE,YAAY,CAAC,UAAMtC,CAAC;YAAA,OAAAuC,SAAA,CAAAd,KAAA;;;;;oBACF,qBAAMzB,CAAC,CAACwC,KAAK,CAC3CH,OAAO,EACPvK,qBAAqB,CAAC2K,kBAAkB,CAACzE,eAAe,EAAE,UAAA0E,CAAC;sBAC1D;sBACA,OAAAA,CAAC,CAACC,GAAG,CAAC,IAAI,EAAErJ,sBAAsB,CAAC;oBAAnC,CAAmC,CACnC,EACD;sBAAEsJ,IAAI,EAAE,CAAC;sBAAEC,KAAK,EAAE;oBAAC,CAAE,CACrB;;oBAPKtH,EAAA,GAAAwC,MAAA,CAAA+E,KAAA,UAAyBhG,EAAA,CAAAiG,IAAA,EAO9B,OAPMC,oBAAoB,GAAAzH,EAAA;0BAU1ByH,oBAAoB,KAAKpI,SAAS,IAClCoI,oBAAoB,CAACzF,KAAK,KAAK3C,SAAS,GADxC;oBAGMqI,WAAW,GAAGC,IAAI,CAACC,KAAK,CAACH,oBAAoB,CAACzF,KAAK,CAAC;0BAEtD0F,WAAW,KAAKzH,OAAO,GAAvB;oBACH,qBAAMwE,CAAC,CAACoD,KAAK,CAAC,KAAK,CAAC;;oBAApBtG,EAAA,CAAAiG,IAAA,EAAoB;;;;;oBAGrB,qBAAM/C,CAAC,CAACqD,IAAI,CACX5E,oBAAoB,CAAC4D,OAAO,EAAE;sBAC7BM,GAAG,EAAErJ,sBAAsB;sBAC3BiE,KAAK,EAAE2F,IAAI,CAACI,SAAS,CAAC9H,OAAO;qBAC7B,CAAC,CACF;;oBALDsB,EAAA,CAAAiG,IAAA,EAKC;;;;;;;WAEF,CAAC;;UA3BFxH,EAAA,CAAAwH,IAAA,EA2BE;;;;;;AAGH,IAAIQ,gBAA4C;AAEhD,SAASnI,YAAYA,CAAA;EACpB,IAAMvB,SAAS,GAAoB;IAClCI,IAAI,EAAE1B,SAAS;IACfqD,aAAa,EAAE,EAAE;IACjB4H,KAAK,EAAE,EAAE;IACTrF,SAAS,EAAE,EAAE;IACbnE,MAAM,EAAE;MACPqI,OAAO,EAAE;QACRpI,IAAI,EAAE,SAAS;QACfwJ,UAAU,EAAE,UAAU;QACtB7C,QAAQ,EAAE,KAAK;QACf1E,MAAM,EAAE;UACPsE,EAAE,EAAE;YACHvG,IAAI,EAAE,IAAI;YACVsC,IAAI,EAAE,IAAI;YACV0C,UAAU,EAAE,IAAI;YAChBG,OAAO,EAAE;WACT;UACDuD,GAAG,EAAE;YACJ1I,IAAI,EAAE,KAAK;YACXsC,IAAI,EAAE,QAAQ;YACd0C,UAAU,EAAE,IAAI;YAChBG,OAAO,EAAE;WACT;UACD7B,KAAK,EAAE;YACNtD,IAAI,EAAE,OAAO;YACbsC,IAAI,EAAE,QAAQ;YACd0C,UAAU,EAAE,IAAI;YAChBG,OAAO,EAAE;;;;;GAKb;EAED,OAAOvF,SAAS;AACjB;AAEA,IAAA6J,SAAA;EAAA,SAAAA,UAAA;IAAA,IAAAjC,KAAA;IACS,KAAAkC,aAAa,GAAwB,EAAE;IAavC,KAAAC,cAAc,GAGlB,IAAInK,OAAO,EAAoC;IAOnD,KAAAoK,KAAK,GAAG;MAAA,OAAAtB,SAAA,CAAAd,KAAA;;;;;;oBACH,IAAI,CAACqC,WAAW,KAAKlJ,SAAS,GAA9B;cACH5B,MAAM,CAAC+K,KAAK,CAAC,oBAAoB,CAAC;cAClC,IAAI,CAACD,WAAW,GAAG,IAAIE,OAAO,CAAC,UAACC,GAAG,EAAEC,GAAG;gBACvCzC,KAAI,CAAC0C,WAAW,GAAGF,GAAG;gBACtBxC,KAAI,CAAC2C,UAAU,GAAGF,GAAG;cACtB,CAAC,CAAC;;;cAEF,qBAAM,IAAI,CAACJ,WAAW;;cAAtBhH,EAAA,CAAAiG,IAAA,EAAsB;cAEtB;;cAGD,IAAI,CAACX,OAAO,GAAG,IAAInK,OAAO,CACzBsB,MAAM,EACNc,iBAAiB,EACjB4H,8BAA8B,EAC9BxD,oBAAoB,EACpB7D,SAAS,EACT,IAAI,CAACyJ,SAAS,CACd;cAED,qBAAM,IAAI,CAACjC,OAAO,CAAC1D,IAAI,EAAE;;cAAzB5B,EAAA,CAAAiG,IAAA,EAAyB;cAEzB,qBAAMZ,kBAAkB,CAAC,IAAI,CAACC,OAAO,EAAE7I,MAAM,CAACiC,OAAO,CAAC;;cAAtDsB,EAAA,CAAAiG,IAAA,EAAsD;cAE9CuB,2BAA2B,GAAK,IAAI,CAACX,aAAa,CAAAW,2BAAvB;mBAE/BA,2BAA2B,EAA3B;cACHtL,MAAM,CAAC+K,KAAK,CAAC,4BAA4B,EAAEO,2BAA2B,CAAC;cAEvE/I,EAAA,OAAI;cAAkB,qBAAM,IAAI,CAACgJ,sBAAsB,EAAE;;cAAzDhJ,EAAA,CAAKqI,cAAc,GAAG9G,EAAA,CAAAiG,IAAA,EAAmC;cAEzD,IAAI,CAACyB,IAAI,GAAG,IAAIrM,UAAU,CACzBoB,MAAM,EACNc,iBAAiB,EACjBC,WAAW,EACXC,WAAW,EACX,IAAI,CAAC6H,OAAO,EACZ3D,oBAAoB,EACpB,IAAI,CAACgG,gBAAgB,EACrB,IAAI,CAACC,YAAY,EACjB,IAAI,CAACC,eAAe,EACpB,IAAI,CAACC,YAAY,EACjB,IAAI,CAAChB,cAAc,EACnB,IAAI,CAACD,aAAa,EAClB,IAAI,CAACkB,gBAAgB,CACrB;cAGKC,8BAA8B,GAAG,IAAI,CAACC,gBAAgB,GAAG,IAAI,GAAG,EAAE;cACxExB,gBAAgB,GAAG,IAAI,CAACiB,IAAI,CAC1BX,KAAK,CAAC;gBAAEkB,gBAAgB,EAAED;cAA8B,CAAE,CAAC,CAC3DE,SAAS,CAAC;gBACV5H,IAAI,EAAE,SAAAA,CAAC7B,EAAc;sBAAZgB,IAAA,GAAAhB,EAAA,CAAAgB,IAAI;oBAAE0I,IAAA,GAAA1J,EAAA,CAAA0J,IAAI;kBAClB;kBACA;kBACA,IAAMC,SAAS,GAAG9L,MAAM,GACrBlB,cAAc,CAACiN,8BAA8B,GAC7CjN,cAAc,CAACkN,8BAA8B;kBAEhD,IAAI7I,IAAI,KAAK2I,SAAS,EAAE;oBACvBzD,KAAI,CAAC0C,WAAW,EAAE;;kBAGnBjN,GAAG,CAACmO,QAAQ,CAAC,WAAW,EAAE;oBACzBC,KAAK,EAAE/I,IAAI;oBACX0I,IAAI,EAAAA;mBACJ,CAAC;gBACH,CAAC;gBACD9D,KAAK,EAAE,SAAAA,CAAAoE,GAAG;kBACTvM,MAAM,CAAC8B,IAAI,CAAC,YAAY,EAAEyK,GAAG,CAAC;kBAC9B9D,KAAI,CAAC2C,UAAU,EAAE;gBAClB;eACA,CAAC;;;cAEHpL,MAAM,CAAC8B,IAAI,CACV,4GAA4G,EAC5G;gBACC0K,MAAM,EAAE,IAAI,CAAC7B;eACb,CACD;cAED,IAAI,CAACQ,WAAW,EAAE;;;cAGnB,qBAAM,IAAI,CAACL,WAAW;;cAAtBhH,EAAA,CAAAiG,IAAA,EAAsB;;;;;KACtB;IAED,KAAAP,KAAK,GAUD,UACH5I,gBAA+C,EAC/C6L,YAAuE,EACvEC,kBAA+C;MAAA,OAAAnD,SAAA,CAAAd,KAAA;;;;;cAE/C,qBAAM,IAAI,CAACoC,KAAK,EAAE;;cAAlBtI,EAAA,CAAAwH,IAAA,EAAkB;cAElB;cAEA,IAAI,CAAC7I,uBAAuB,CAACN,gBAAgB,CAAC,EAAE;gBACzCsH,GAAG,GAAG,sCAAsC;gBAClDlI,MAAM,CAACmI,KAAK,CAACD,GAAG,EAAE;kBAAEtH,gBAAgB,EAAAA;gBAAA,CAAE,CAAC;gBAEvC,MAAM,IAAIiD,KAAK,CAACqE,GAAG,CAAC;;cAGrB,IAAI,OAAOuE,YAAY,KAAK,QAAQ,EAAE;gBACrC,IAAIC,kBAAkB,KAAK9K,SAAS,EAAE;kBACrC5B,MAAM,CAAC8B,IAAI,CAAC,2CAA2C,CAAC;;;cAIpDkD,eAAe,GAAGrE,kBAAkB,CAACC,gBAAgB,CAAC;cAG5D,IAAI+H,UAAU,CAAC8D,YAAY,CAAC,EAAE;gBAC7BE,SAAS,GAAG7N,qBAAqB,CAAC8N,WAAW,CAC5C5H,eAAe,EACfyH,YAAY,CACZ;eACD,MAAM;gBACN,IAAI5N,eAAe,CAAC4N,YAAY,CAAC,EAAE;kBAClC;kBACAE,SAAS,GAAG/K,SAAS;iBACrB,MAAM;kBACN+K,SAAS,GAAG7N,qBAAqB,CAAC2K,kBAAkB,CACnDzE,eAAe,EACfyH,YAAY,CACZ;;;cAIGI,UAAU,GAAG,IAAI,CAACC,iBAAiB,CACxC9H,eAAe,EACf0H,kBAAkB,CAClB;cAED;cAEA1M,MAAM,CAAC+K,KAAK,CAAC,cAAc,EAAE;gBAC5BnK,gBAAgB,EAAAA,gBAAA;gBAChB+L,SAAS,EAAE7N,qBAAqB,CAACiO,aAAa,CAACJ,SAAS,EAAE,KAAK,CAAC;gBAChEE,UAAU,EAAA5K,QAAA,CAAAA,QAAA,KACN4K,UAAU;kBACbG,IAAI,EAAEjO,yBAAyB,CAACgO,aAAa,CAC5CF,UAAU,IAAIA,UAAU,CAACG,IAAI,EAC7B,KAAK;gBACL;eAEF,CAAC;cAEa,qBAAM,IAAI,CAAC5D,OAAO,CAACI,KAAK,CACtC5I,gBAAgB,EAChB+L,SAAS,EACTE,UAAU,CACV;;cAJKnJ,MAAM,GAAGnB,EAAA,CAAAwH,IAAA,EAId;cAED,sBAAOpB,UAAU,CAAC8D,YAAY,CAAC,GAAG/I,MAAM,CAAC,CAAC,CAAC,GAAGA,MAAM;;;;KACpD;IAED,KAAA2G,IAAI,GAAG,UACNrH,KAAQ,EACRiK,SAAqC;MAAA,OAAA1D,SAAA,CAAAd,KAAA;;;;;;cAErC,qBAAM,IAAI,CAACoC,KAAK,EAAE;;cAAlB/G,EAAA,CAAAiG,IAAA,EAAkB;cAIZmD,YAAY,GAAGxM,eAAe,CAACI,GAAG,CAACkC,KAAK,CAAC;cAEzCpC,gBAAgB,GAAkCoC,KAAK,GAC3BA,KAAK,CAACiF,WAAW,GAChDrG,SAAS;cAEZ,IAAI,CAACV,uBAAuB,CAACN,gBAAgB,CAAC,EAAE;gBACzCsH,GAAG,GAAG,4CAA4C;gBACxDlI,MAAM,CAACmI,KAAK,CAACD,GAAG,EAAE;kBAAElF,KAAK,EAAAA;gBAAA,CAAE,CAAC;gBAE5B,MAAM,IAAIa,KAAK,CAACqE,GAAG,CAAC;;cAGflD,eAAe,GAAGrE,kBAAkB,CAACC,gBAAgB,CAAC;cAEtDuM,iBAAiB,GAAGrO,qBAAqB,CAAC2K,kBAAkB,CACjEzE,eAAe,EACfiI,SAAS,CACT;cAEoB,qBAAM,IAAI,CAAC7D,OAAO,CAACE,YAAY,CAAC,UAAMtC,CAAC;gBAAA,OAAAuC,SAAA,CAAAd,KAAA;;;;wBAC3D,qBAAMzB,CAAC,CAACqD,IAAI,CAACrH,KAAK,EAAEmK,iBAAiB,EAAEvL,SAAS,EAAEsL,YAAY,CAAC;;wBAA/D3K,EAAA,CAAAwH,IAAA,EAA+D;wBAE/D,sBAAO/C,CAAC,CAACwC,KAAK,CACb5I,gBAAgB,EAChB9B,qBAAqB,CAAC8N,WAAW,CAAC5H,eAAe,EAAEhC,KAAK,CAACwE,EAAE,CAAC,CAC5D;;;;eACD,CAAC;;cAPIjF,EAAA,GAAAwC,MAAA,CAAA+E,KAAA,UAAehG,EAAA,CAAAiG,IAAA,EAOnB,OAPKqD,UAAU,GAAA7K,EAAA;cASjB,sBAAO6K,UAAU;;;;KACjB;IAED,KAAAC,kBAAkB,GAAG,UAACb,MAAuB;MACpC,IAAAc,eAAA,GAAAd,MAAA,CAAA9B,SAA0B;MAElC,IAAM6C,wBAAwB,GAAkB,SAAAA,CAAA;QAC/C,OAAA9E,KAAI,CAACkD,eAAe,KAAK/C,sBAAsB;MAA/C,CAA+C;MAEhD,IAAI0E,eAAe,EAAE;QACpB,OAAOA,eAAe,CAAC3B,eAAe;;MAEvC,IAAI4B,wBAAwB,EAAE,IAAIf,MAAM,CAACb,eAAe,EAAE;QACzD,OAAOa,MAAM,CAACb,eAAe;;MAG9B,OAAOlD,KAAI,CAACkD,eAAe,IAAI/C,sBAAsB;IACtD,CAAC;IAED,KAAA4E,eAAe,GAAG,UAAChB,MAAuB;MACjC,IAAAc,eAAA,GAAAd,MAAA,CAAA9B,SAA0B;MAElC,IAAM+C,qBAAqB,GAAkB,SAAAA,CAAA;QAC5C,OAAAhF,KAAI,CAACmD,YAAY,KAAK5C,mBAAmB;MAAzC,CAAyC;MAE1C,IAAIsE,eAAe,EAAE;QACpB,OAAOA,eAAe,CAAC1B,YAAY;;MAEpC,IAAI6B,qBAAqB,EAAE,IAAIjB,MAAM,CAACZ,YAAY,EAAE;QACnD,OAAOY,MAAM,CAACZ,YAAY;;MAG3B,OAAOnD,KAAI,CAACmD,YAAY,IAAI5C,mBAAmB;IAChD,CAAC;IAED,KAAArE,MAAM,GAaF,UACH+I,kBAAqD,EACrDjB,YAAuE;MAAA,OAAAlD,SAAA,CAAAd,KAAA;;;;;cAEvE,qBAAM,IAAI,CAACoC,KAAK,EAAE;;cAAlB8C,EAAA,CAAA5D,IAAA,EAAkB;cAIlB,IAAI,CAAC2D,kBAAkB,EAAE;gBAClBxF,GAAG,GAAG,qCAAqC;gBACjDlI,MAAM,CAACmI,KAAK,CAACD,GAAG,EAAE;kBAAEwF,kBAAkB,EAAAA;gBAAA,CAAE,CAAC;gBAEzC,MAAM,IAAI7J,KAAK,CAACqE,GAAG,CAAC;;mBAGjBhH,uBAAuB,CAACwM,kBAAkB,CAAC,EAA3C;cACG9M,gBAAgB,GAAG8M,kBAAkB;cAE3C,IAAI,CAACjB,YAAY,EAAE;gBACZvE,GAAG,GACR,mFAAmF;gBACpFlI,MAAM,CAACmI,KAAK,CAACD,GAAG,EAAE;kBAAEuE,YAAY,EAAAA;gBAAA,CAAE,CAAC;gBAEnC,MAAM,IAAI5I,KAAK,CAACqE,GAAG,CAAC;;cAGrB,IAAI,OAAOuE,YAAY,KAAK,QAAQ,EAAE;gBACrCQ,SAAS,GAAGnO,qBAAqB,CAAC8N,WAAW,CAC5CjM,kBAAkB,CAACC,gBAAgB,CAAC,EACpC6L,YAAY,CACZ;eACD,MAAM;gBACNQ,SAAS,GAAGnO,qBAAqB,CAAC2K,kBAAkB,CACnD9I,kBAAkB,CAACC,gBAAgB,CAAC;gBACpC;;;;gBAIA6L,YAAyC,CACzC;gBAED,IAAI,CAACQ,SAAS,IAAI,CAACnO,qBAAqB,CAAC8O,gBAAgB,CAACX,SAAS,CAAC,EAAE;kBAC/D/E,GAAG,GACR,mEAAmE;kBACpElI,MAAM,CAACmI,KAAK,CAACD,GAAG,EAAE;oBAAE+E,SAAS,EAAAA;kBAAA,CAAE,CAAC;kBAEhC,MAAM,IAAIpJ,KAAK,CAACqE,GAAG,CAAC;;;cAIJ,qBAAM,IAAI,CAACkB,OAAO,CAACzE,MAAM,CAAC/D,gBAAgB,EAAEqM,SAAS,CAAC;;cAAlE1K,EAAA,GAAAwC,MAAA,CAAA+E,KAAA,UAAY6D,EAAA,CAAA5D,IAAA,EAAsD,OAAjE8D,OAAO,GAAAtL,EAAA;cAEd,sBAAOsL,OAAO;;cAER7K,KAAK,GAAG0K,kBAAkB;cAC1B9M,gBAAgB,GAAG6B,MAAM,CAACuF,cAAc,CAAChF,KAAK,IAAI,EAAE,CAAC,CACzDiF,WAA4C;cAE9C,IAAI,CAAC/G,uBAAuB,CAACN,gBAAgB,CAAC,EAAE;gBACzCsH,GAAG,GAAG,4CAA4C;gBACxDlI,MAAM,CAACmI,KAAK,CAACD,GAAG,EAAE;kBAAElF,KAAK,EAAAA;gBAAA,CAAE,CAAC;gBAE5B,MAAM,IAAIa,KAAK,CAACqE,GAAG,CAAC;;cAGflD,eAAe,GAAGrE,kBAAkB,CAACC,gBAAgB,CAAC;cAEtDkN,WAAW,GAAGhP,qBAAqB,CAAC8N,WAAW,CACpD5H,eAAe,EACfhC,KAAK,CAACwE,EAAE,CACR;cAED,IAAIiF,YAAY,EAAE;gBACjB,IAAI,OAAOA,YAAY,KAAK,UAAU,EAAE;kBACjCvE,GAAG,GAAG,kBAAkB;kBAC9BlI,MAAM,CAACmI,KAAK,CAACD,GAAG,EAAE;oBAAEuE,YAAY,EAAAA;kBAAA,CAAE,CAAC;kBAEnC,MAAM,IAAI5I,KAAK,CAACqE,GAAG,CAAC;;gBAGrB+E,SAAS,GAAGR,YAAY,CAACqB,WAAW,CAAC;eACrC,MAAM;gBACNb,SAAS,GAAGa,WAAW;;cAGJ,qBAAM,IAAI,CAAC1E,OAAO,CAACzE,MAAM,CAAC3B,KAAK,EAAEiK,SAAS,CAAC;;cAAzDnJ,EAAA,GAAAiB,MAAA,CAAA+E,KAAA,UAAc6D,EAAA,CAAA5D,IAAA,EAA2C,OAAxD5F,EAAA,GAAAY,MAAA,CAAAjB,EAAA,OAAS,EAAR+J,OAAO,GAAA1J,EAAA;cAEf,sBAAO0J,OAAO;;;;KAEf;IAED,KAAAE,OAAO,GASH,UACHL,kBAAsD,EACtDjB,YAAiD;MAEjD,IAAIE,SAA4B;MAEhC,IAAM/L,gBAAgB,GACrB8M,kBAAkB,IAAIxM,uBAAuB,CAACwM,kBAAkB,CAAC,GAC9DA,kBAAkB,GAClB9L,SAAS;MAEb,IAAI8L,kBAAkB,IAAI9M,gBAAgB,KAAKgB,SAAS,EAAE;QACzD,IAAMoB,KAAK,GAAM0K,kBAAkB;QACnC,IAAMM,kBAAgB,GACrBhL,KAAK,IAAaP,MAAM,CAACuF,cAAc,CAAChF,KAAK,CAAE,CAACiF,WAAW;QAE5D,IAAI/G,uBAAuB,CAAI8M,kBAAgB,CAAC,EAAE;UACjD,IAAIvB,YAAY,EAAE;YACjBzM,MAAM,CAAC8B,IAAI,CAAC,qDAAqD,EAAE;cAClEkB,KAAK,EAAAA,KAAA;cACLyJ,YAAY,EAAAA;aACZ,CAAC;;UAGH,OAAOhE,KAAI,CAACsF,OAAO,CAACC,kBAAgB,EAAEhL,KAAK,CAACwE,EAAE,CAAC;SAC/C,MAAM;UACN,IAAMU,GAAG,GACR,8DAA8D;UAC/DlI,MAAM,CAACmI,KAAK,CAACD,GAAG,EAAE;YAAElF,KAAK,EAAAA;UAAA,CAAE,CAAC;UAE5B,MAAM,IAAIa,KAAK,CAACqE,GAAG,CAAC;;;MAItB,IAAIuE,YAAY,KAAK7K,SAAS,IAAIhB,gBAAgB,KAAKgB,SAAS,EAAE;QACjE,IAAMsG,GAAG,GAAG,oDAAoD;QAChElI,MAAM,CAACmI,KAAK,CAACD,GAAG,EAAEuE,YAAY,CAAC;QAC/B,MAAM,IAAI5I,KAAK,CAACqE,GAAG,CAAC;;MAGrB,IAAItH,gBAAgB,IAAI,CAACM,uBAAuB,CAACN,gBAAgB,CAAC,EAAE;QACnE,IAAMsH,GAAG,GAAG,sCAAsC;QAClDlI,MAAM,CAACmI,KAAK,CAACD,GAAG,EAAE;UAAEtH,gBAAgB,EAAAA;QAAA,CAAE,CAAC;QAEvC,MAAM,IAAIiD,KAAK,CAACqE,GAAG,CAAC;;MAGrB,IAAI,OAAOuE,YAAY,KAAK,QAAQ,EAAE;QACrCE,SAAS,GAAG7N,qBAAqB,CAAC8N,WAAW,CAC5CjM,kBAAkB,CAACC,gBAAgB,CAAC,EACpC6L,YAAY,CACZ;OACD,MAAM;QACNE,SAAS,GACR/L,gBAAgB,IAChB9B,qBAAqB,CAAC2K,kBAAkB,CACvC9I,kBAAkB,CAACC,gBAAgB,CAAC,EACpC6L,YAAY,CACZ;;MAGH,OAAO,IAAI/N,UAAU,CAAyB,UAAAuP,QAAQ;QACrD,IAAIC,MAAkC;QAEtC,CAAC;UAAA,OAAA3E,SAAA,CAAAd,KAAA;;;;kBACA,qBAAM,IAAI,CAACoC,KAAK,EAAE;;kBAAlBtI,EAAA,CAAAwH,IAAA,EAAkB;kBAElBmE,MAAM,GAAG,IAAI,CAAC9E,OAAO,CACnB2E,OAAO,CAACnN,gBAAgB,EAAE+L,SAAS,CAAC,CACpCxJ,MAAM,CAAC,UAACZ,EAAS;wBAAPS,KAAA,GAAAT,EAAA,CAAAS,KAAK;oBAAO,OAAA3B,iBAAiB,CAAC2B,KAAK,CAAC,KAAKlD,IAAI;kBAAjC,CAAiC,CAAC,CACxDkM,SAAS,CAACiC,QAAQ,CAAC;;;;;SACrB,EAAC,CAAE;QAEJ,OAAO;UACN,IAAIC,MAAM,EAAE;YACXA,MAAM,CAACC,WAAW,EAAE;;QAEtB,CAAC;MACF,CAAC,CAAC;IACH,CAAC;IAED,KAAAC,SAAS,GAAG,UAAC5B,MAA4B;MAA5B,IAAAA,MAAA;QAAAA,MAAA,KAA4B;MAAA;MAEvC,IAAAc,eAAA,GAAAd,MAAA,CAAA9B,SAA0B;QAC1B2D,0BAAA,GAAA7B,MAAA,CAAA8B,oBAAgD;QAChDC,qBAAA,GAAA/B,MAAA,CAAAb,eAAsC;QACtC6C,kBAAA,GAAAhC,MAAA,CAAAZ,YAAgC;QAChC6C,sBAAA,GAAAjC,MAAA,CAAAf,gBAAwC;QACxCiD,kBAAA,GAAAlC,MAAA,CAAAd,YAAgC;QAChCiD,sBAAA,GAAAnC,MAAA,CAAAT,gBAAwC;QACxC6C,qBAAA,GAAApC,MAAA,CAAAqC,eAAsC;QACtCC,iBAAA,GAAAC,MAAA,CAAAvC,MAAA,sJAAoB;MAGrB/D,KAAI,CAACkC,aAAa,GAAA1I,QAAA,CAAAA,QAAA,KAAQ6M,iBAAiB,GAAKrG,KAAI,CAACkC,aAAa,CAAE;MAEpElC,KAAI,CAACkD,eAAe,GAAGlD,KAAI,CAAC4E,kBAAkB,CAACb,MAAM,CAAC;MACtD/D,KAAI,CAACmD,YAAY,GAAGnD,KAAI,CAAC+E,eAAe,CAAChB,MAAM,CAAC;MAEhD,IAAM8B,oBAAoB,GACxBhB,eAAe,IAAIA,eAAe,CAACgB,oBAAoB,IACxDD,0BAA0B,IAC1B/O,oBAAoB,CAAC0P,OAAO;MAE7B,QAAQV,oBAAoB;QAC3B,KAAKhP,oBAAoB,CAAC2P,UAAU;UACnCxG,KAAI,CAACoD,gBAAgB,GAAGjN,iBAAiB;UACzC;QACD,KAAKU,oBAAoB,CAAC0P,OAAO;UAChCvG,KAAI,CAACoD,gBAAgB,GAAGlN,mBAAmB;UAC3C;QACD;UACC8J,KAAI,CAACoD,gBAAgB,GAAGlN,mBAAmB;UAC3C;;MAGF8J,KAAI,CAACoG,eAAe,GAClBvB,eAAe,IAAIA,eAAe,CAACuB,eAAe,IACnDpG,KAAI,CAACoG,eAAe,IACpBD,qBAAqB;MAEtBnG,KAAI,CAACgD,gBAAgB,GACnB6B,eAAe,IAAIA,eAAe,CAAC7B,gBAAgB,IACpDhD,KAAI,CAACgD,gBAAgB,IACrBgD,sBAAsB;MAEvBhG,KAAI,CAACiD,YAAY,GACf4B,eAAe,IAAIA,eAAe,CAAC5B,YAAY,IAChDjD,KAAI,CAACiD,YAAY,IACjBgD,kBAAkB;MAEnBjG,KAAI,CAACsD,gBAAgB,GACnBuB,eAAe,IAAIA,eAAe,CAACvB,gBAAgB,IACpDtD,KAAI,CAACsD,gBAAgB,IACrB4C,sBAAsB,IACtB,EAAE,GAAG,EAAE,CAAC,CAAC;MAEVlG,KAAI,CAAC4C,SAAS,GAAG5C,KAAI,CAACyG,iBAAiB,EAAE;IAC1C,CAAC;IAED,KAAA9E,KAAK,GAAG,SAAeA,KAAKA,CAAA;;;;;cAC3B,IAAI,IAAI,CAAChB,OAAO,KAAKxH,SAAS,EAAE;gBAC/B;;cAGD,IAAI2I,gBAAgB,IAAI,CAACA,gBAAgB,CAAC4E,MAAM,EAAE;gBACjD5E,gBAAgB,CAAC4D,WAAW,EAAE;;cAG/B,qBAAM,IAAI,CAAC/E,OAAO,CAACgB,KAAK,EAAE;;cAA1B7H,EAAA,CAAAwH,IAAA,EAA0B;cAE1B,IAAI,IAAI,CAACyB,IAAI,EAAE;gBACd,IAAI,CAACA,IAAI,CAAC4D,uBAAuB,EAAE;;cAGpC,IAAI,CAACtE,WAAW,GAAGlJ,SAAS,CAAC,CAAC;cAC9B,IAAI,CAACwH,OAAO,GAAGxH,SAAS;cACxB,IAAI,CAAC4J,IAAI,GAAG5J,SAAS;cACrB,IAAI,CAACgJ,cAAc,GAAG,IAAInK,OAAO,EAAoC;;;;;KACrE;IAED,KAAA4O,IAAI,GAAG,SAAeA,IAAIA,CAAA;;;;;oBACrB,IAAI,CAACvE,WAAW,KAAKlJ,SAAS,GAA9B;cACH,qBAAM,IAAI,CAACiJ,KAAK,EAAE;;cAAlBtI,EAAA,CAAAwH,IAAA,EAAkB;;;cAGnB,IAAIQ,gBAAgB,IAAI,CAACA,gBAAgB,CAAC4E,MAAM,EAAE;gBACjD5E,gBAAgB,CAAC4D,WAAW,EAAE;;cAG/B,IAAI,IAAI,CAAC3C,IAAI,EAAE;gBACd,IAAI,CAACA,IAAI,CAAC4D,uBAAuB,EAAE;;cAGpC,IAAI,CAACtE,WAAW,GAAGlJ,SAAS,CAAC,CAAC;cAC9B,IAAI,CAAC4J,IAAI,GAAG5J,SAAS;;;;;KACrB;EAyJF;EA/qBC8I,SAAA,CAAA4E,SAAA,CAAAC,aAAa,GAAb;IACC,OAAO,WAAW;EACnB,CAAC;EAshBO7E,SAAA,CAAA4E,SAAA,CAAAxC,iBAAiB,GAAzB,UACC9H,eAA4B,EAC5B0H,kBAA8C;IAE9C,IAAI8C,aAA+B;IAC7B,IAAAjN,EAAA,GAAAmK,kBAAA,MAAgD;MAA9C7C,KAAA,GAAAtH,EAAA,CAAAsH,KAAK;MAAED,IAAA,GAAArH,EAAA,CAAAqH,IAAI;MAAEoD,IAAA,GAAAzK,EAAA,CAAAyK,IAAiC;IAEtD,IAAInD,KAAK,KAAKjI,SAAS,IAAIgI,IAAI,KAAKhI,SAAS,IAAIoL,IAAI,KAAKpL,SAAS,EAAE;MACpE,OAAOA,SAAS;;IAGjB,IAAIgI,IAAI,KAAKhI,SAAS,IAAIiI,KAAK,KAAKjI,SAAS,EAAE;MAC9C,MAAM,IAAIiC,KAAK,CAAC,0CAA0C,CAAC;;IAG5D,IAAI+F,IAAI,KAAKhI,SAAS,EAAE;MACvB,IAAI,OAAOgI,IAAI,KAAK,QAAQ,EAAE;QAC7B,MAAM,IAAI/F,KAAK,CAAC,yBAAyB,CAAC;;MAG3C,IAAI+F,IAAI,GAAG,CAAC,EAAE;QACb,MAAM,IAAI/F,KAAK,CAAC,wBAAwB,CAAC;;;IAI3C,IAAIgG,KAAK,KAAKjI,SAAS,EAAE;MACxB,IAAI,OAAOiI,KAAK,KAAK,QAAQ,EAAE;QAC9B,MAAM,IAAIhG,KAAK,CAAC,0BAA0B,CAAC;;MAG5C,IAAIgG,KAAK,GAAG,CAAC,EAAE;QACd,MAAM,IAAIhG,KAAK,CAAC,yBAAyB,CAAC;;;IAI5C,IAAImJ,IAAI,EAAE;MACTwC,aAAa,GAAGzQ,yBAAyB,CAAC0K,kBAAkB,CAC3DzE,eAAe,EACf0H,kBAAkB,CAACM,IAAI,CACvB;;IAGF,OAAO;MACNnD,KAAK,EAAAA,KAAA;MACLD,IAAI,EAAAA,IAAA;MACJoD,IAAI,EAAEwC;KACN;EACF,CAAC;EAEa9E,SAAA,CAAA4E,SAAA,CAAA/D,sBAAsB,GAApC;;;;;;;YAGC,IAAI,CAAC,IAAI,CAACsD,eAAe,IAAI,CAAC,IAAI,CAACA,eAAe,CAACvG,MAAM,EAAE;cAC1D,sBAAO,IAAI7H,OAAO,EAAoC;;YAGhC,qBAAMuK,OAAO,CAACyE,GAAG,CACvC,IAAI,CAACZ,eAAe,CAAChI,GAAG,CACvB,UACC6I,cAA8B;cAAA,OAAAnG,SAAA,CAAAd,KAAA;;;;;sBAEkB,qBAAMiH,cAAc;;sBAA9DnN,EAAA,GAA0CuB,EAAA,CAAAiG,IAAA,EAAoB,EAA5DnJ,gBAAgB,GAAA2B,EAAA,CAAA3B,gBAAA,EAAE+O,iBAAiB,GAAApN,EAAA,CAAAoN,iBAAA;sBACrC3K,eAAe,GAAGrE,kBAAkB,CAACC,gBAAgB,CAAC;sBAI1C,qBAAM,IAAI,CAACgP,aAAa,CAACD,iBAAiB,CAAC;;sBAAvD1C,SAAS,GAAGnJ,EAAA,CAAAiG,IAAA,EAA2C;sBAC7D,IAAIlL,eAAe,CAACoO,SAAS,CAAC,EAAE;wBAC/B,sBAAO,CAACjI,eAAe,EAAE,IAAI,CAAC;;sBAGzB2H,SAAS,GAAG,IAAI,CAACkD,mBAAmB,CACzC7K,eAAe,EACfiI,SAAS,CACT;sBAED,sBAAO,CAACjI,eAAe,EAAE2H,SAAS,CAAC;;;;aACnC,CACD,CACD;;YAvBK/B,cAAc,GAAGrI,EAAA,CAAAwH,IAAA,EAuBtB;YAED,sBAAO,IAAI,CAAC+F,kBAAkB,CAAClF,cAAc,CAAC;;;;GAC9C;EAEOF,SAAA,CAAA4E,SAAA,CAAAO,mBAAmB,GAA3B,UACC7K,eAA4B,EAC5BiI,SAAkD;IAElD,IAAI;MACH,OAAOnO,qBAAqB,CAAC2K,kBAAkB,CAC9CzE,eAAe,EACfiI,SAAS,CACT;KACD,CAAC,OAAO9E,KAAK,EAAE;MACfnI,MAAM,CAACmI,KAAK,CAAC,+BAA+B,CAAC;MAC7C,MAAMA,KAAK;;EAEb,CAAC;EAEauC,SAAA,CAAA4E,SAAA,CAAAM,aAAa,GAA3B,UACCD,iBAAiB;;;;;;;YAGE,qBAAMA,iBAAiB,EAAE;;YAArC1C,SAAS,GAAG1K,EAAA,CAAAwH,IAAA,EAAyB;YAC3C,sBAAOkD,SAAS;;;YAEhB,IAAI8C,OAAK,YAAYC,SAAS,EAAE;cAC/B,sBAAOL,iBAAiB;;YAEzB,MAAMI,OAAK;;;;;;GAEZ;EAEOrF,SAAA,CAAA4E,SAAA,CAAAQ,kBAAkB,GAA1B,UACChL,OAA6C;IAE7C,OAAOA,OAAO,CAACmL,MAAM,CAAC,UAACpJ,GAAG,EAAEtE,EAA4B;UAA5BuB,EAAA,GAAAiB,MAAA,CAAAxC,EAAA,IAA4B;QAA3ByC,eAAA,GAAAlB,EAAA,GAAe;QAAE6I,SAAA,GAAA7I,EAAA,GAAS;MACtD,IAAI+C,GAAG,CAACzF,GAAG,CAAC4D,eAAe,CAAC,EAAE;QACrB,IAAAkL,MAAA,GAAAlL,eAAA,CAAA/D,IAAI;QACZjB,MAAM,CAAC8B,IAAI,CACV,wGAC2CoO,MAAI,4BAAyB,CACxE;QACD,OAAOrJ,GAAG;;MAGX,IAAI8F,SAAS,EAAE;QACd9F,GAAG,CAACpD,GAAG,CAACuB,eAAe,EAAE2H,SAAS,CAAC;;MAGpC,OAAO9F,GAAG;IACX,CAAC,EAAE,IAAIpG,OAAO,EAAoC,CAAC;EACpD,CAAC;EAED;EACQiK,SAAA,CAAA4E,SAAA,CAAAJ,iBAAiB,GAAzB;IACC,IAAI;MACH,IAAM7D,SAAS,GAAG8E,cAAc,CAACC,OAAO,CAAC,oBAAoB,CAAC;MAE9D,IAAI/E,SAAS,EAAE;QACN,IAAAC,2BAAA,QAAAX,aAAA,CAAAW,2BAA2B;QAEnC,IAAM+E,UAAU,GAAG/E,2BAA2B,CAACgF,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QACtD,IAAA/N,EAAA,GAAAwC,MAAA,CAAAsL,UAAA,CAAAC,KAAA,SAAmC;UAAlCC,SAAA,GAAAhO,EAAA,GAAkC;QAEzC,OAAU8I,SAAS,SAAIkF,SAAW;;KAEnC,CAAC,OAAAzM,EAAA,EAAM;MACP,OAAOlC,SAAS;;EAElB,CAAC;EACF,OAAA8I,SAAC;AAAD,CAAC,CAnsBD;AAqsBA,IAAMrD,QAAQ,GAAG,IAAIqD,SAAS,EAAE;AAChC3M,OAAO,CAACyS,QAAQ,CAACnJ,QAAQ,CAAC;AAE1B,SAASqD,SAAS,IAAI+F,cAAc,EAAE/O,UAAU,EAAE2F,QAAQ,IAAIqD,SAAS","ignoreList":[]},"metadata":{},"sourceType":"module"}