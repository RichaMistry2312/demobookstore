{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar universal_cookie_1 = __importDefault(require(\"universal-cookie\"));\nvar JS_1 = require(\"../JS\");\nvar isBrowser = JS_1.browserOrNode().isBrowser;\nvar UniversalStorage = /** @class */function () {\n  function UniversalStorage(context) {\n    if (context === void 0) {\n      context = {};\n    }\n    this.cookies = new universal_cookie_1.default();\n    this.store = isBrowser ? window.localStorage : Object.create(null);\n    this.cookies = context.req ? new universal_cookie_1.default(context.req.headers.cookie) : new universal_cookie_1.default();\n    Object.assign(this.store, this.cookies.getAll());\n  }\n  Object.defineProperty(UniversalStorage.prototype, \"length\", {\n    get: function () {\n      return Object.entries(this.store).length;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  UniversalStorage.prototype.clear = function () {\n    var _this = this;\n    Array.from(new Array(this.length)).map(function (_, i) {\n      return _this.key(i);\n    }).forEach(function (key) {\n      return _this.removeItem(key);\n    });\n  };\n  UniversalStorage.prototype.getItem = function (key) {\n    return this.getLocalItem(key);\n  };\n  UniversalStorage.prototype.getLocalItem = function (key) {\n    return Object.prototype.hasOwnProperty.call(this.store, key) ? this.store[key] : null;\n  };\n  UniversalStorage.prototype.getUniversalItem = function (key) {\n    return this.cookies.get(key);\n  };\n  UniversalStorage.prototype.key = function (index) {\n    return Object.keys(this.store)[index];\n  };\n  UniversalStorage.prototype.removeItem = function (key) {\n    this.removeLocalItem(key);\n    this.removeUniversalItem(key);\n  };\n  UniversalStorage.prototype.removeLocalItem = function (key) {\n    delete this.store[key];\n  };\n  UniversalStorage.prototype.removeUniversalItem = function (key) {\n    this.cookies.remove(key, {\n      path: '/'\n    });\n  };\n  UniversalStorage.prototype.setItem = function (key, value) {\n    this.setLocalItem(key, value);\n    // keys take the shape:\n    //  1. `${ProviderPrefix}.${userPoolClientId}.${username}.${tokenType}\n    //  2. `${ProviderPrefix}.${userPoolClientId}.LastAuthUser\n    var tokenType = key.split('.').pop();\n    switch (tokenType) {\n      // LastAuthUser is needed for computing other key names\n      case 'LastAuthUser':\n      // accessToken is required for CognitoUserSession\n      case 'accessToken':\n      // Required for CognitoUserSession\n      case 'idToken':\n        this.setUniversalItem(key, value);\n      // userData is used when `Auth.currentAuthenticatedUser({ bypassCache: false })`.\n      // Can be persisted to speed up calls to `Auth.currentAuthenticatedUser()`\n      // case 'userData':\n      // refreshToken isn't shared with the server so that the client handles refreshing\n      // case 'refreshToken':\n      // Ignoring clockDrift on the server for now, but needs testing\n      // case 'clockDrift':\n    }\n  };\n  UniversalStorage.prototype.setLocalItem = function (key, value) {\n    this.store[key] = value;\n  };\n  UniversalStorage.prototype.setUniversalItem = function (key, value) {\n    this.cookies.set(key, value, {\n      path: '/',\n      // `httpOnly` cannot be set via JavaScript: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#JavaScript_access_using_Document.cookie\n      sameSite: true,\n      // Allow unsecure requests to http://localhost:3000/ when in development.\n      secure: window.location.hostname === 'localhost' ? false : true\n    });\n  };\n  return UniversalStorage;\n}();\nexports.UniversalStorage = UniversalStorage;","map":{"version":3,"names":["universal_cookie_1","__importDefault","require","JS_1","isBrowser","browserOrNode","UniversalStorage","context","cookies","default","store","window","localStorage","Object","create","req","headers","cookie","assign","getAll","defineProperty","prototype","get","entries","length","clear","_this","Array","from","map","_","i","key","forEach","removeItem","getItem","getLocalItem","hasOwnProperty","call","getUniversalItem","index","keys","removeLocalItem","removeUniversalItem","remove","path","setItem","value","setLocalItem","tokenType","split","pop","setUniversalItem","set","sameSite","secure","location","hostname","exports"],"sources":["../../src/UniversalStorage/index.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}